<Window x:Class="MusicEngineEditor.Views.MediaBayView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Media Bay"
        Width="1000" Height="700"
        MinWidth="800" MinHeight="500"
        WindowStartupLocation="CenterOwner"
        Background="#0D0D0D"
        Foreground="#E0E0E0">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

        <!-- Star Rating Colors -->
        <SolidColorBrush x:Key="StarActiveBrush" Color="#FFD700"/>
        <SolidColorBrush x:Key="StarInactiveBrush" Color="#4A4A4A"/>

        <!-- Color Label Brushes -->
        <SolidColorBrush x:Key="LabelRed" Color="#E85C5C"/>
        <SolidColorBrush x:Key="LabelOrange" Color="#E8A73C"/>
        <SolidColorBrush x:Key="LabelYellow" Color="#E8E85C"/>
        <SolidColorBrush x:Key="LabelGreen" Color="#00FF88"/>
        <SolidColorBrush x:Key="LabelBlue" Color="#00D9FF"/>
        <SolidColorBrush x:Key="LabelPurple" Color="#9C7CE8"/>
        <SolidColorBrush x:Key="LabelNone" Color="Transparent"/>

        <!-- Folder Tree Item Style -->
        <Style x:Key="FolderTreeItemStyle" TargetType="TreeViewItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TreeViewItem">
                        <StackPanel>
                            <Border x:Name="Bd"
                                    Background="{TemplateBinding Background}"
                                    Padding="{TemplateBinding Padding}"
                                    CornerRadius="4"
                                    Margin="0,1">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <ToggleButton x:Name="Expander"
                                                  IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}}"
                                                  ClickMode="Press"
                                                  Background="Transparent"
                                                  BorderThickness="0"
                                                  Width="16" Height="16"
                                                  Margin="0,0,4,0">
                                        <ToggleButton.Template>
                                            <ControlTemplate TargetType="ToggleButton">
                                                <Border Background="Transparent">
                                                    <Path x:Name="arrow"
                                                          Data="M 0,0 L 4,4 L 0,8 Z"
                                                          Fill="#6E6E6E"
                                                          VerticalAlignment="Center"
                                                          HorizontalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsChecked" Value="True">
                                                        <Setter TargetName="arrow" Property="Data" Value="M 0,0 L 8,0 L 4,4 Z"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </ToggleButton.Template>
                                    </ToggleButton>

                                    <Path Grid.Column="1"
                                          Data="M 0,2 L 14,2 L 14,12 L 0,12 Z M 0,2 L 4,0 L 6,0 L 6,2"
                                          Fill="#6E9BDB"
                                          Margin="0,0,6,0"
                                          Width="14" Height="12"
                                          VerticalAlignment="Center"/>

                                    <ContentPresenter Grid.Column="2"
                                                      ContentSource="Header"
                                                      HorizontalAlignment="Left"
                                                      VerticalAlignment="Center"/>
                                </Grid>
                            </Border>
                            <ItemsPresenter x:Name="ItemsHost" Margin="16,0,0,0"/>
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="HasItems" Value="False">
                                <Setter TargetName="Expander" Property="Visibility" Value="Hidden"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#252525"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#00D9FF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- File List Item Style -->
        <Style x:Key="FileListItemStyle" TargetType="ListViewItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Margin" Value="0,1"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="4">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#252525"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#00D9FF"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Tag Button Style -->
        <Style x:Key="TagButtonStyle" TargetType="ToggleButton">
            <Setter Property="Background" Value="#333337"/>
            <Setter Property="Foreground" Value="#A0A0A0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="3"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#454549"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#00D9FF"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250" MinWidth="200"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="250" MinWidth="200"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="120"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Grid.ColumnSpan="5"
                Background="#181818"
                BorderBrush="#252525"
                BorderThickness="0,0,0,1"
                Padding="16,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Media Bay"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="White"
                               VerticalAlignment="Center"/>
                    <TextBlock x:Name="FileCountText"
                               Text=" - 0 files"
                               FontSize="12"
                               Foreground="#808080"
                               VerticalAlignment="Center"
                               Margin="8,0,0,0"/>
                </StackPanel>

                <!-- Search Box -->
                <Border Grid.Column="1"
                        Background="#141414"
                        BorderBrush="#252525"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="8,4"
                        Width="300"
                        Margin="0,0,16,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Path Data="M 6,0 A 6,6 0 1 1 5.99,0 M 10,10 L 14,14"
                              Stroke="#6E6E6E"
                              StrokeThickness="1.5"
                              Width="16" Height="16"
                              Margin="0,0,8,0"
                              VerticalAlignment="Center"/>
                        <TextBox x:Name="SearchBox"
                                 Grid.Column="1"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 Foreground="#E0E0E0"
                                 CaretBrush="#E0E0E0"
                                 FontSize="12"
                                 VerticalAlignment="Center"
                                 TextChanged="SearchBox_TextChanged"/>
                    </Grid>
                </Border>

                <!-- View Toggle -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button x:Name="ListViewButton"
                            Content="List"
                            Padding="12,6"
                            Background="#00D9FF"
                            Foreground="White"
                            BorderThickness="0"
                            Click="ListViewButton_Click"/>
                    <Button x:Name="GridViewButton"
                            Content="Grid"
                            Padding="12,6"
                            Background="#333337"
                            Foreground="#A0A0A0"
                            BorderThickness="0"
                            Click="GridViewButton_Click"
                            Margin="4,0,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Left Panel - Folder Tree -->
        <Border Grid.Row="1" Grid.RowSpan="3" Grid.Column="0"
                Background="#181818"
                BorderBrush="#252525"
                BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Locations Header -->
                <Border Grid.Row="0"
                        BorderBrush="#252525"
                        BorderThickness="0,0,0,1"
                        Padding="12,8">
                    <TextBlock Text="Locations"
                               FontWeight="SemiBold"
                               FontSize="12"
                               Foreground="#808080"/>
                </Border>

                <!-- Folder Tree -->
                <TreeView x:Name="FolderTree"
                          Grid.Row="1"
                          Background="Transparent"
                          BorderThickness="0"
                          Padding="8"
                          ItemContainerStyle="{StaticResource FolderTreeItemStyle}"
                          SelectedItemChanged="FolderTree_SelectedItemChanged"/>

                <!-- Quick Access -->
                <Border Grid.Row="2"
                        BorderBrush="#252525"
                        BorderThickness="0,1,0,0"
                        Padding="8">
                    <StackPanel>
                        <TextBlock Text="Quick Access"
                                   FontWeight="SemiBold"
                                   FontSize="11"
                                   Foreground="#808080"
                                   Margin="4,0,0,8"/>
                        <Button Content="Add Current Folder"
                                Background="#333337"
                                Foreground="#A0A0A0"
                                BorderThickness="0"
                                Padding="8,6"
                                HorizontalAlignment="Stretch"
                                Click="AddFavoriteButton_Click"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <GridSplitter Grid.Row="1" Grid.RowSpan="3" Grid.Column="1"
                      Width="4"
                      Background="#181818"
                      HorizontalAlignment="Center"/>

        <!-- Center - File List -->
        <ListView x:Name="FileListView"
                  Grid.Row="1" Grid.Column="2"
                  Background="Transparent"
                  BorderThickness="0"
                  Padding="8"
                  ItemContainerStyle="{StaticResource FileListItemStyle}"
                  SelectionChanged="FileListView_SelectionChanged"
                  MouseDoubleClick="FileListView_MouseDoubleClick"
                  AllowDrop="False">
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Name" Width="200">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Border Width="4" Height="14"
                                            CornerRadius="2"
                                            Margin="0,0,8,0"
                                            Background="{Binding ColorLabelBrush}"/>
                                    <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="Rating" Width="80">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding StarDisplay}"
                                               Foreground="#FFD700"
                                               FontSize="10"/>
                                </StackPanel>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="Type" Width="60" DisplayMemberBinding="{Binding Format}"/>
                    <GridViewColumn Header="Duration" Width="70" DisplayMemberBinding="{Binding DurationDisplay}"/>
                    <GridViewColumn Header="BPM" Width="50" DisplayMemberBinding="{Binding BpmDisplay}"/>
                    <GridViewColumn Header="Key" Width="50" DisplayMemberBinding="{Binding KeyDisplay}"/>
                    <GridViewColumn Header="Tags" Width="150" DisplayMemberBinding="{Binding TagsDisplay}"/>
                    <GridViewColumn Header="Size" Width="70" DisplayMemberBinding="{Binding SizeDisplay}"/>
                </GridView>
            </ListView.View>
        </ListView>

        <GridSplitter Grid.Row="1" Grid.Column="3"
                      Width="4"
                      Background="#181818"
                      HorizontalAlignment="Center"/>

        <!-- Right Panel - Tags and Filters -->
        <Border Grid.Row="1" Grid.Column="4"
                Background="#181818"
                BorderBrush="#252525"
                BorderThickness="1,0,0,0">
            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="8">
                <StackPanel>
                    <!-- Rating Filter -->
                    <TextBlock Text="Rating"
                               FontWeight="SemiBold"
                               FontSize="12"
                               Foreground="#808080"
                               Margin="4,8,0,8"/>
                    <WrapPanel>
                        <ToggleButton x:Name="Star5Filter" Style="{StaticResource TagButtonStyle}" Content="5 Stars" Click="RatingFilter_Click"/>
                        <ToggleButton x:Name="Star4Filter" Style="{StaticResource TagButtonStyle}" Content="4+ Stars" Click="RatingFilter_Click"/>
                        <ToggleButton x:Name="Star3Filter" Style="{StaticResource TagButtonStyle}" Content="3+ Stars" Click="RatingFilter_Click"/>
                        <ToggleButton x:Name="StarAnyFilter" Style="{StaticResource TagButtonStyle}" Content="Any" IsChecked="True" Click="RatingFilter_Click"/>
                    </WrapPanel>

                    <!-- Color Labels -->
                    <TextBlock Text="Color Labels"
                               FontWeight="SemiBold"
                               FontSize="12"
                               Foreground="#808080"
                               Margin="4,16,0,8"/>
                    <WrapPanel>
                        <ToggleButton Style="{StaticResource TagButtonStyle}" Tag="Red" Click="ColorFilter_Click">
                            <Border Width="12" Height="12" CornerRadius="2" Background="{StaticResource LabelRed}"/>
                        </ToggleButton>
                        <ToggleButton Style="{StaticResource TagButtonStyle}" Tag="Orange" Click="ColorFilter_Click">
                            <Border Width="12" Height="12" CornerRadius="2" Background="{StaticResource LabelOrange}"/>
                        </ToggleButton>
                        <ToggleButton Style="{StaticResource TagButtonStyle}" Tag="Yellow" Click="ColorFilter_Click">
                            <Border Width="12" Height="12" CornerRadius="2" Background="{StaticResource LabelYellow}"/>
                        </ToggleButton>
                        <ToggleButton Style="{StaticResource TagButtonStyle}" Tag="Green" Click="ColorFilter_Click">
                            <Border Width="12" Height="12" CornerRadius="2" Background="{StaticResource LabelGreen}"/>
                        </ToggleButton>
                        <ToggleButton Style="{StaticResource TagButtonStyle}" Tag="Blue" Click="ColorFilter_Click">
                            <Border Width="12" Height="12" CornerRadius="2" Background="{StaticResource LabelBlue}"/>
                        </ToggleButton>
                        <ToggleButton Style="{StaticResource TagButtonStyle}" Tag="Purple" Click="ColorFilter_Click">
                            <Border Width="12" Height="12" CornerRadius="2" Background="{StaticResource LabelPurple}"/>
                        </ToggleButton>
                    </WrapPanel>

                    <!-- Tags -->
                    <TextBlock Text="Tags"
                               FontWeight="SemiBold"
                               FontSize="12"
                               Foreground="#808080"
                               Margin="4,16,0,8"/>
                    <ItemsControl x:Name="TagsPanel">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <ToggleButton Style="{StaticResource TagButtonStyle}"
                                              Content="{Binding Name}"
                                              IsChecked="{Binding IsSelected}"
                                              Click="TagFilter_Click"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- Format Filter -->
                    <TextBlock Text="Format"
                               FontWeight="SemiBold"
                               FontSize="12"
                               Foreground="#808080"
                               Margin="4,16,0,8"/>
                    <WrapPanel>
                        <ToggleButton Style="{StaticResource TagButtonStyle}" Content="WAV" Tag="wav" Click="FormatFilter_Click"/>
                        <ToggleButton Style="{StaticResource TagButtonStyle}" Content="MP3" Tag="mp3" Click="FormatFilter_Click"/>
                        <ToggleButton Style="{StaticResource TagButtonStyle}" Content="FLAC" Tag="flac" Click="FormatFilter_Click"/>
                        <ToggleButton Style="{StaticResource TagButtonStyle}" Content="OGG" Tag="ogg" Click="FormatFilter_Click"/>
                        <ToggleButton Style="{StaticResource TagButtonStyle}" Content="AIFF" Tag="aiff" Click="FormatFilter_Click"/>
                    </WrapPanel>

                    <!-- Clear Filters -->
                    <Button Content="Clear All Filters"
                            Background="#333337"
                            Foreground="#A0A0A0"
                            BorderThickness="0"
                            Padding="8,8"
                            Margin="0,16,0,0"
                            HorizontalAlignment="Stretch"
                            Click="ClearFiltersButton_Click"/>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Bottom Bar - Selected File Info -->
        <Border Grid.Row="2" Grid.Column="2" Grid.ColumnSpan="3"
                Background="#181818"
                BorderBrush="#252525"
                BorderThickness="0,1,0,0"
                Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal">
                    <TextBlock x:Name="SelectedFileInfo"
                               Text="No file selected"
                               Foreground="#808080"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Rating Editor -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,0,16,0">
                    <TextBlock Text="Rating:"
                               Foreground="#808080"
                               VerticalAlignment="Center"
                               Margin="0,0,8,0"/>
                    <Button x:Name="Star1" Content="*" FontSize="16" Padding="2" Background="Transparent" BorderThickness="0" Foreground="#4A4A4A" Click="StarButton_Click" Tag="1"/>
                    <Button x:Name="Star2" Content="*" FontSize="16" Padding="2" Background="Transparent" BorderThickness="0" Foreground="#4A4A4A" Click="StarButton_Click" Tag="2"/>
                    <Button x:Name="Star3" Content="*" FontSize="16" Padding="2" Background="Transparent" BorderThickness="0" Foreground="#4A4A4A" Click="StarButton_Click" Tag="3"/>
                    <Button x:Name="Star4" Content="*" FontSize="16" Padding="2" Background="Transparent" BorderThickness="0" Foreground="#4A4A4A" Click="StarButton_Click" Tag="4"/>
                    <Button x:Name="Star5" Content="*" FontSize="16" Padding="2" Background="Transparent" BorderThickness="0" Foreground="#4A4A4A" Click="StarButton_Click" Tag="5"/>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="Add to Timeline"
                            Background="#00D9FF"
                            Foreground="White"
                            BorderThickness="0"
                            Padding="16,6"
                            Click="AddToTimelineButton_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Waveform Preview -->
        <Border Grid.Row="3" Grid.Column="2" Grid.ColumnSpan="3"
                Background="#141414"
                BorderBrush="#252525"
                BorderThickness="0,1,0,0">
            <Grid>
                <Canvas x:Name="WaveformCanvas" ClipToBounds="True"/>
                <TextBlock x:Name="PreviewFileName"
                           Text="Select a file to preview"
                           Foreground="#808080"
                           FontSize="12"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Bottom"
                            Margin="12,8">
                    <Button x:Name="PlayPreviewButton"
                            Content="Play"
                            Background="#333337"
                            Foreground="#E0E0E0"
                            BorderThickness="0"
                            Padding="12,4"
                            Click="PlayPreviewButton_Click"/>
                    <Button x:Name="StopPreviewButton"
                            Content="Stop"
                            Background="#333337"
                            Foreground="#E0E0E0"
                            BorderThickness="0"
                            Padding="12,4"
                            Margin="8,0,0,0"
                            Click="StopPreviewButton_Click"/>
                </StackPanel>
                <TextBlock x:Name="PreviewDuration"
                           HorizontalAlignment="Right"
                           VerticalAlignment="Bottom"
                           Margin="12,8"
                           Foreground="#808080"
                           FontSize="11"/>
            </Grid>
        </Border>
    </Grid>
</Window>
