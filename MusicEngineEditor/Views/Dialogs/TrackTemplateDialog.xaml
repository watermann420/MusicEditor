<Window x:Class="MusicEngineEditor.Views.Dialogs.TrackTemplateDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Track Templates"
        Width="850" Height="600"
        MinWidth="700" MinHeight="500"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        Background="{DynamicResource BackgroundBrush}"
        Foreground="{DynamicResource ForegroundBrush}">

    <Window.Resources>
        <!-- Colors -->
        <Color x:Key="BackgroundColor">#0D0D0D</Color>
        <Color x:Key="PanelBackgroundColor">#181818</Color>
        <Color x:Key="BorderColor">#2A2A2A</Color>
        <Color x:Key="TextPrimaryColor">#E0E0E0</Color>
        <Color x:Key="TextSecondaryColor">#808080</Color>
        <Color x:Key="AccentColor">#55AAFF</Color>
        <Color x:Key="HoverColor">#252525</Color>

        <!-- Brushes -->
        <SolidColorBrush x:Key="BackgroundBrush" Color="{StaticResource BackgroundColor}"/>
        <SolidColorBrush x:Key="PanelBackgroundBrush" Color="{StaticResource PanelBackgroundColor}"/>
        <SolidColorBrush x:Key="BorderBrush" Color="{StaticResource BorderColor}"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="{StaticResource TextPrimaryColor}"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="{StaticResource TextSecondaryColor}"/>
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}"/>
        <SolidColorBrush x:Key="HoverBrush" Color="{StaticResource HoverColor}"/>

        <!-- BoolToVisibility Converter -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

        <!-- Template List Item Style -->
        <Style x:Key="TemplateListItemStyle" TargetType="ListBoxItem">
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="Margin" Value="0,1"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="4">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource HoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource AccentBrush}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Category Button Style -->
        <Style x:Key="CategoryButtonStyle" TargetType="RadioButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="0,1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Left"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource HoverBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource AccentBrush}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Converters -->
        <local:StringToColorConverter x:Key="StringToColorConverter" xmlns:local="clr-namespace:MusicEngineEditor.Views.Dialogs"/>
        <local:NullToVisibilityConverter x:Key="NullToVisibilityConverter" xmlns:local="clr-namespace:MusicEngineEditor.Views.Dialogs"/>
    </Window.Resources>

    <Grid Margin="0">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="180"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="280"/>
        </Grid.ColumnDefinitions>

        <!-- Left Panel: Categories -->
        <Border Grid.Column="0" Background="{StaticResource PanelBackgroundBrush}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Categories Header -->
                <Border Padding="16,12" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                    <TextBlock Text="Categories" FontWeight="SemiBold" FontSize="13"/>
                </Border>

                <!-- Category List -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="8">
                    <StackPanel x:Name="CategoryPanel">
                        <RadioButton x:Name="AllCategory" Content="All Templates" Style="{StaticResource CategoryButtonStyle}"
                                     IsChecked="True" Checked="Category_Checked"/>
                        <RadioButton x:Name="GeneralCategory" Content="General" Style="{StaticResource CategoryButtonStyle}" Checked="Category_Checked"/>
                        <RadioButton x:Name="DrumsCategory" Content="Drums" Style="{StaticResource CategoryButtonStyle}" Checked="Category_Checked"/>
                        <RadioButton x:Name="BassCategory" Content="Bass" Style="{StaticResource CategoryButtonStyle}" Checked="Category_Checked"/>
                        <RadioButton x:Name="SynthCategory" Content="Synth" Style="{StaticResource CategoryButtonStyle}" Checked="Category_Checked"/>
                        <RadioButton x:Name="GuitarCategory" Content="Guitar" Style="{StaticResource CategoryButtonStyle}" Checked="Category_Checked"/>
                        <RadioButton x:Name="VocalsCategory" Content="Vocals" Style="{StaticResource CategoryButtonStyle}" Checked="Category_Checked"/>
                        <RadioButton x:Name="KeysCategory" Content="Keys" Style="{StaticResource CategoryButtonStyle}" Checked="Category_Checked"/>
                        <RadioButton x:Name="FXCategory" Content="FX" Style="{StaticResource CategoryButtonStyle}" Checked="Category_Checked"/>
                        <RadioButton x:Name="BusCategory" Content="Bus" Style="{StaticResource CategoryButtonStyle}" Checked="Category_Checked"/>
                        <RadioButton x:Name="CustomCategory" Content="Custom" Style="{StaticResource CategoryButtonStyle}" Checked="Category_Checked"/>
                    </StackPanel>
                </ScrollViewer>

                <!-- Import/Export -->
                <Border Grid.Row="2" Padding="8" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0">
                    <StackPanel>
                        <Button Content="Import Template..." Click="Import_Click" Padding="8,6" Margin="0,0,0,4"
                                Background="{StaticResource BackgroundBrush}" Foreground="{StaticResource TextPrimaryBrush}"
                                BorderBrush="{StaticResource BorderBrush}"/>
                        <Button Content="Export Selected..." Click="Export_Click" Padding="8,6"
                                Background="{StaticResource BackgroundBrush}" Foreground="{StaticResource TextPrimaryBrush}"
                                BorderBrush="{StaticResource BorderBrush}"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Center Panel: Template List -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Search Bar -->
            <Border Padding="16,12" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox x:Name="SearchTextBox" Text=""
                             Background="{StaticResource BackgroundBrush}"
                             Foreground="{StaticResource TextPrimaryBrush}"
                             BorderBrush="{StaticResource BorderBrush}"
                             Padding="8,6"
                             TextChanged="SearchTextBox_TextChanged">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Style.Triggers>
                                    <Trigger Property="Text" Value="">
                                        <Setter Property="Tag" Value="Search templates..."/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="8,0,0,0">
                        <TextBlock x:Name="TemplateCountText" Text="10 templates" VerticalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Template List -->
            <ListBox x:Name="TemplateListBox" Grid.Row="1"
                     Background="Transparent"
                     BorderThickness="0"
                     ItemContainerStyle="{StaticResource TemplateListItemStyle}"
                     SelectionChanged="TemplateListBox_SelectionChanged"
                     MouseDoubleClick="TemplateListBox_MouseDoubleClick">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Color Indicator -->
                            <Border Width="4" Height="40" CornerRadius="2" Margin="0,0,12,0">
                                <Border.Background>
                                    <SolidColorBrush Color="{Binding Color, Converter={StaticResource StringToColorConverter}}"/>
                                </Border.Background>
                            </Border>

                            <!-- Template Info -->
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="13"/>
                                <TextBlock Text="{Binding Description}" FontSize="11" Opacity="0.7"
                                           TextTrimming="CharacterEllipsis" MaxWidth="300"/>
                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                    <TextBlock Text="{Binding TrackType}" FontSize="10"
                                               Foreground="{StaticResource AccentBrush}" Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding InstrumentType}" FontSize="10" Opacity="0.6"
                                               Visibility="{Binding InstrumentType, Converter={StaticResource NullToVisibilityConverter}}"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Built-in Badge -->
                            <Border Grid.Column="2" Visibility="{Binding IsBuiltIn, Converter={StaticResource BoolToVisibilityConverter}}"
                                    Background="{StaticResource AccentBrush}" CornerRadius="8" Padding="8,3" VerticalAlignment="Center">
                                <TextBlock Text="Built-in" FontSize="10" Foreground="White"/>
                            </Border>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>

        <!-- Right Panel: Template Details -->
        <Border Grid.Column="2" Background="{StaticResource PanelBackgroundBrush}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="1,0,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Details Header -->
                <Border Padding="16,12" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                    <TextBlock Text="Template Details" FontWeight="SemiBold" FontSize="13"/>
                </Border>

                <!-- Details Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="16">
                    <StackPanel x:Name="DetailsPanel">
                        <!-- No Selection State -->
                        <TextBlock x:Name="NoSelectionText" Text="Select a template to view details"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   HorizontalAlignment="Center" Margin="0,40,0,0"/>

                        <!-- Template Details (shown when selected) -->
                        <StackPanel x:Name="TemplateDetails" Visibility="Collapsed">
                            <!-- Name -->
                            <TextBlock x:Name="DetailName" Text="Template Name" FontWeight="SemiBold" FontSize="16" Margin="0,0,0,4"/>
                            <TextBlock x:Name="DetailDescription" Text="Description" TextWrapping="Wrap"
                                       Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,16"/>

                            <!-- Track Info -->
                            <TextBlock Text="TRACK INFO" FontSize="10" FontWeight="SemiBold" Opacity="0.6" Margin="0,0,0,8"/>
                            <Grid Margin="0,0,0,16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Type:" Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock x:Name="DetailTrackType" Grid.Row="0" Grid.Column="1"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Instrument:" Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock x:Name="DetailInstrument" Grid.Row="1" Grid.Column="1"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Output:" Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock x:Name="DetailOutput" Grid.Row="2" Grid.Column="1"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Category:" Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock x:Name="DetailCategory" Grid.Row="3" Grid.Column="1"/>
                            </Grid>

                            <!-- Effects Chain -->
                            <TextBlock Text="EFFECTS CHAIN" FontSize="10" FontWeight="SemiBold" Opacity="0.6" Margin="0,0,0,8"/>
                            <Border Background="{StaticResource BackgroundBrush}" CornerRadius="4" Padding="8" Margin="0,0,0,16">
                                <ItemsControl x:Name="EffectsList">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                                <Ellipse Width="6" Height="6" Fill="{StaticResource AccentBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                <TextBlock Text="{Binding EffectType}" FontSize="12"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Items.Count, ElementName=EffectsList}" Value="0">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                            </Border>
                            <TextBlock x:Name="NoEffectsText" Text="No effects" Foreground="{StaticResource TextSecondaryBrush}"
                                       FontSize="11" Margin="0,0,0,16"/>

                            <!-- Sends -->
                            <TextBlock Text="SENDS" FontSize="10" FontWeight="SemiBold" Opacity="0.6" Margin="0,0,0,8"/>
                            <ItemsControl x:Name="SendsList" Margin="0,0,0,16">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <TextBlock Text="{Binding TargetBus}" FontSize="12" Margin="0,0,8,0"/>
                                            <TextBlock Text="{Binding Level, StringFormat='{}{0:P0}'}" FontSize="11" Opacity="0.7"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <TextBlock x:Name="NoSendsText" Text="No sends" Foreground="{StaticResource TextSecondaryBrush}"
                                       FontSize="11" Margin="0,0,0,16"/>

                            <!-- Tags -->
                            <TextBlock Text="TAGS" FontSize="10" FontWeight="SemiBold" Opacity="0.6" Margin="0,0,0,8"/>
                            <ItemsControl x:Name="TagsList">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{StaticResource BackgroundBrush}" CornerRadius="10" Padding="8,3" Margin="0,0,4,4">
                                            <TextBlock Text="{Binding}" FontSize="10"/>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>

                <!-- Action Buttons -->
                <Border Grid.Row="2" Padding="16" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0">
                    <StackPanel>
                        <Button Content="Create Track from Template" Click="CreateTrack_Click" Padding="12,8" Margin="0,0,0,8"
                                Background="{StaticResource AccentBrush}" Foreground="White" BorderBrush="{StaticResource AccentBrush}"
                                IsEnabled="False" x:Name="CreateTrackButton"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button Content="Edit" Click="Edit_Click" Padding="8,6" Margin="0,0,4,0"
                                    Background="{StaticResource BackgroundBrush}" Foreground="{StaticResource TextPrimaryBrush}"
                                    BorderBrush="{StaticResource BorderBrush}" IsEnabled="False" x:Name="EditButton"/>
                            <Button Grid.Column="1" Content="Delete" Click="Delete_Click" Padding="8,6" Margin="4,0,0,0"
                                    Background="{StaticResource BackgroundBrush}" Foreground="#FF4757"
                                    BorderBrush="{StaticResource BorderBrush}" IsEnabled="False" x:Name="DeleteButton"/>
                        </Grid>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
