<Window x:Class="MusicEngineEditor.Views.Dialogs.PerformanceDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:MusicEngineEditor.Views.Dialogs"
        mc:Ignorable="d"
        Title="Performance Monitor"
        Height="550" Width="650"
        MinHeight="400" MinWidth="500"
        WindowStartupLocation="CenterOwner"
        Style="{StaticResource DarkWindowStyle}"
        Background="#0D0D0D"
        ResizeMode="CanResizeWithGrip">

    <Window.Resources>
        <!-- Graph colors -->
        <Color x:Key="GraphLineColor">#00D9FF</Color>
        <Color x:Key="GraphFillColor">#334B6EAF</Color>
        <Color x:Key="GraphGridColor">#181818</Color>
        <Color x:Key="CpuLowColor">#00FF88</Color>
        <Color x:Key="CpuMediumColor">#FFB800</Color>
        <Color x:Key="CpuHighColor">#FF4757</Color>

        <SolidColorBrush x:Key="GraphLineBrush" Color="{StaticResource GraphLineColor}"/>
        <SolidColorBrush x:Key="GraphGridBrush" Color="{StaticResource GraphGridColor}"/>
        <SolidColorBrush x:Key="CpuLowBrush" Color="{StaticResource CpuLowColor}"/>
        <SolidColorBrush x:Key="CpuMediumBrush" Color="{StaticResource CpuMediumColor}"/>
        <SolidColorBrush x:Key="CpuHighBrush" Color="{StaticResource CpuHighColor}"/>

        <!-- Section header style -->
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>

        <!-- Stat label style -->
        <Style x:Key="StatLabelStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#808080"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Margin" Value="0,2"/>
        </Style>

        <!-- Stat value style -->
        <Style x:Key="StatValueStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#DFE1E5"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontFamily" Value="JetBrains Mono, Consolas"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,2"/>
            <Setter Property="HorizontalAlignment" Value="Right"/>
        </Style>

        <!-- Large stat value style -->
        <Style x:Key="LargeStatValueStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#DFE1E5"/>
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontFamily" Value="JetBrains Mono, Consolas"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Margin="0,0,0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="Performance Monitor"
                           FontSize="18"
                           FontWeight="SemiBold"
                           Foreground="#DFE1E5"
                           VerticalAlignment="Center"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="ResetButton"
                            Content="Reset Stats"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Click="ResetButton_Click"
                            Margin="0,0,8,0"/>
                    <Button x:Name="CloseButton"
                            Content="Close"
                            Style="{StaticResource PrimaryButtonStyle}"
                            Click="CloseButton_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="200"/>
            </Grid.ColumnDefinitions>

            <!-- Left: CPU Graph -->
            <Border Grid.Column="0"
                    Background="#181818"
                    BorderBrush="#2A2A2A"
                    BorderThickness="1"
                    CornerRadius="6"
                    Margin="0,0,12,0"
                    Padding="12">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top"
                               Text="CPU Usage (Last 30 seconds)"
                               Style="{StaticResource SectionHeaderStyle}"/>

                    <!-- Graph Canvas -->
                    <Border Background="#0D0D0D"
                            BorderBrush="#2A2A2A"
                            BorderThickness="1"
                            CornerRadius="4">
                        <Grid>
                            <!-- Grid lines -->
                            <Canvas x:Name="GridCanvas" ClipToBounds="True"/>
                            <!-- Graph line -->
                            <Canvas x:Name="GraphCanvas" ClipToBounds="True"/>
                            <!-- Scale labels -->
                            <Canvas x:Name="ScaleCanvas" Width="30" HorizontalAlignment="Left"/>
                        </Grid>
                    </Border>
                </DockPanel>
            </Border>

            <!-- Right: Stats Panel -->
            <Border Grid.Column="1"
                    Background="#181818"
                    BorderBrush="#2A2A2A"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="12">
                <StackPanel>
                    <!-- CPU Stats -->
                    <TextBlock Text="CPU" Style="{StaticResource SectionHeaderStyle}"/>

                    <Grid Margin="0,0,0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Current" Style="{StaticResource StatLabelStyle}"/>
                        <TextBlock x:Name="CpuCurrentText"
                                   Grid.Column="1"
                                   Text="0.0%"
                                   Style="{StaticResource StatValueStyle}"/>
                    </Grid>

                    <Grid Margin="0,0,0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Peak" Style="{StaticResource StatLabelStyle}"/>
                        <TextBlock x:Name="CpuPeakText"
                                   Grid.Column="1"
                                   Text="0.0%"
                                   Style="{StaticResource StatValueStyle}"
                                   Foreground="{StaticResource CpuMediumBrush}"/>
                    </Grid>

                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Average" Style="{StaticResource StatLabelStyle}"/>
                        <TextBlock x:Name="CpuAverageText"
                                   Grid.Column="1"
                                   Text="0.0%"
                                   Style="{StaticResource StatValueStyle}"/>
                    </Grid>

                    <!-- Memory Stats -->
                    <TextBlock Text="Memory" Style="{StaticResource SectionHeaderStyle}"/>

                    <Grid Margin="0,0,0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Current" Style="{StaticResource StatLabelStyle}"/>
                        <TextBlock x:Name="MemoryCurrentText"
                                   Grid.Column="1"
                                   Text="0 MB"
                                   Style="{StaticResource StatValueStyle}"/>
                    </Grid>

                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Peak" Style="{StaticResource StatLabelStyle}"/>
                        <TextBlock x:Name="MemoryPeakText"
                                   Grid.Column="1"
                                   Text="0 MB"
                                   Style="{StaticResource StatValueStyle}"/>
                    </Grid>

                    <!-- Audio Stats -->
                    <TextBlock Text="Audio" Style="{StaticResource SectionHeaderStyle}"/>

                    <Grid Margin="0,0,0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Latency" Style="{StaticResource StatLabelStyle}"/>
                        <TextBlock x:Name="LatencyText"
                                   Grid.Column="1"
                                   Text="0.0 ms"
                                   Style="{StaticResource StatValueStyle}"/>
                    </Grid>

                    <Grid Margin="0,0,0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Buffer Size" Style="{StaticResource StatLabelStyle}"/>
                        <TextBlock x:Name="BufferSizeText"
                                   Grid.Column="1"
                                   Text="512 samples"
                                   Style="{StaticResource StatValueStyle}"/>
                    </Grid>

                    <Grid Margin="0,0,0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Sample Rate" Style="{StaticResource StatLabelStyle}"/>
                        <TextBlock x:Name="SampleRateText"
                                   Grid.Column="1"
                                   Text="44100 Hz"
                                   Style="{StaticResource StatValueStyle}"/>
                    </Grid>

                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Dropouts" Style="{StaticResource StatLabelStyle}"/>
                        <TextBlock x:Name="DropoutText"
                                   Grid.Column="1"
                                   Text="0"
                                   Style="{StaticResource StatValueStyle}"
                                   Foreground="{StaticResource CpuLowBrush}"/>
                    </Grid>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Plugin CPU Breakdown -->
        <Border Grid.Row="2"
                Background="#181818"
                BorderBrush="#2A2A2A"
                BorderThickness="1"
                CornerRadius="6"
                Margin="0,12,0,0"
                Padding="12"
                MaxHeight="150">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top"
                           Text="Plugin CPU Usage"
                           Style="{StaticResource SectionHeaderStyle}"/>

                <ListView x:Name="PluginListView"
                          Background="Transparent"
                          BorderThickness="0"
                          Foreground="#E0E0E0"
                          ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Plugin" Width="250" DisplayMemberBinding="{Binding Name}"/>
                            <GridViewColumn Header="CPU %" Width="80" DisplayMemberBinding="{Binding CpuUsageFormatted}"/>
                            <GridViewColumn Header="" Width="150">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Background="#0D0D0D"
                                                Height="8"
                                                CornerRadius="2"
                                                Width="140">
                                            <Border HorizontalAlignment="Left"
                                                    Background="{StaticResource GraphLineBrush}"
                                                    CornerRadius="2"
                                                    Width="{Binding CpuUsage, Converter={x:Static local:PercentToWidthConverter.Instance}}"/>
                                        </Border>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="Padding" Value="4"/>
                            <Setter Property="Margin" Value="0"/>
                        </Style>
                    </ListView.ItemContainerStyle>
                </ListView>

                <!-- Empty state -->
                <TextBlock x:Name="NoPluginsText"
                           Text="No plugins loaded"
                           Foreground="#808080"
                           FontStyle="Italic"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Visibility="Collapsed"/>
            </DockPanel>
        </Border>

        <!-- Footer -->
        <Border Grid.Row="3" Margin="0,12,0,0">
            <Grid>
                <TextBlock Text="Performance data updates every 100ms"
                           Foreground="#808080"
                           FontSize="10"
                           VerticalAlignment="Center"/>
                <TextBlock x:Name="LastUpdateText"
                           Text="Last update: --"
                           Foreground="#808080"
                           FontSize="10"
                           HorizontalAlignment="Right"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</Window>
