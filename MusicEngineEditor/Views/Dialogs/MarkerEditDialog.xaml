<Window x:Class="MusicEngineEditor.Views.Dialogs.MarkerEditDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Edit Marker"
        Width="400" Height="380"
        MinWidth="350" MinHeight="340"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="{DynamicResource BackgroundBrush}"
        Foreground="{DynamicResource ForegroundBrush}">

    <Window.Resources>
        <!-- Color Swatch Button Style -->
        <Style x:Key="ColorSwatchStyle" TargetType="Button">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid>
                            <Border x:Name="OuterBorder"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="Transparent"
                                    BorderThickness="2"
                                    CornerRadius="4"/>
                            <Border x:Name="InnerBorder"
                                    Background="{TemplateBinding Background}"
                                    CornerRadius="3"
                                    Margin="2"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="OuterBorder" Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                            </Trigger>
                            <Trigger Property="Tag" Value="Selected">
                                <Setter TargetName="OuterBorder" Property="BorderBrush" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Form Label Style -->
        <Style x:Key="FormLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{DynamicResource SecondaryForegroundBrush}"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
        </Style>

        <!-- Form TextBox Style -->
        <Style x:Key="FormTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="{DynamicResource EditorBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0"
                   Text="Edit Marker"
                   FontSize="16"
                   FontWeight="SemiBold"
                   Margin="0,0,0,16"/>

        <!-- Name Field -->
        <StackPanel Grid.Row="1" Margin="0,0,0,12">
            <TextBlock Text="Name" Style="{StaticResource FormLabelStyle}"/>
            <TextBox x:Name="NameTextBox"
                     Style="{StaticResource FormTextBoxStyle}"/>
        </StackPanel>

        <!-- Type Field -->
        <StackPanel Grid.Row="2" Margin="0,0,0,12">
            <TextBlock Text="Type" Style="{StaticResource FormLabelStyle}"/>
            <ComboBox x:Name="TypeComboBox"
                      Background="{DynamicResource EditorBackgroundBrush}"
                      Foreground="{DynamicResource ForegroundBrush}"
                      Padding="8,6"
                      SelectionChanged="TypeComboBox_SelectionChanged">
                <ComboBoxItem Content="Cue" Tag="Cue"/>
                <ComboBoxItem Content="Loop" Tag="Loop"/>
                <ComboBoxItem Content="Section" Tag="Section"/>
            </ComboBox>
        </StackPanel>

        <!-- Position Fields -->
        <Grid Grid.Row="3" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="*" x:Name="EndPositionColumn"/>
            </Grid.ColumnDefinitions>

            <!-- Start Position -->
            <StackPanel Grid.Column="0">
                <TextBlock Text="Position (beats)" Style="{StaticResource FormLabelStyle}"/>
                <TextBox x:Name="PositionTextBox"
                         Style="{StaticResource FormTextBoxStyle}"/>
            </StackPanel>

            <!-- End Position (for Loop markers) -->
            <StackPanel Grid.Column="2" x:Name="EndPositionPanel" Visibility="Collapsed">
                <TextBlock Text="End Position (beats)" Style="{StaticResource FormLabelStyle}"/>
                <TextBox x:Name="EndPositionTextBox"
                         Style="{StaticResource FormTextBoxStyle}"/>
            </StackPanel>
        </Grid>

        <!-- Color Picker -->
        <StackPanel Grid.Row="4" Margin="0,0,0,12">
            <TextBlock Text="Color" Style="{StaticResource FormLabelStyle}"/>

            <!-- Color Palette -->
            <WrapPanel x:Name="ColorPalette" Margin="0,4,0,8">
                <!-- Predefined colors will be added programmatically -->
            </WrapPanel>

            <!-- Custom Color -->
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Custom:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"
                           FontSize="11"
                           Foreground="{DynamicResource SecondaryForegroundBrush}"/>
                <TextBox x:Name="CustomColorTextBox"
                         Width="100"
                         Style="{StaticResource FormTextBoxStyle}"
                         TextChanged="CustomColorTextBox_TextChanged"/>
                <Border x:Name="ColorPreview"
                        Width="32"
                        Height="28"
                        Margin="8,0,0,0"
                        CornerRadius="4"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="1"/>
            </StackPanel>
        </StackPanel>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="6"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,16,0,0">
            <Button Content="OK"
                    IsDefault="True"
                    Click="OkButton_Click"
                    Padding="24,8"
                    Margin="0,0,8,0"
                    Background="{DynamicResource AccentBrush}"
                    Foreground="White"/>
            <Button Content="Cancel"
                    IsCancel="True"
                    Padding="24,8"/>
        </StackPanel>
    </Grid>
</Window>
