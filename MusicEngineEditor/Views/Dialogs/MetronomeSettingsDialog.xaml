<Window x:Class="MusicEngineEditor.Views.Dialogs.MetronomeSettingsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:services="clr-namespace:MusicEngineEditor.Services"
        mc:Ignorable="d"
        Title="Metronome Settings"
        Width="480" Height="520"
        MinWidth="400" MinHeight="450"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        Background="{DynamicResource BackgroundBrush}"
        Foreground="{DynamicResource ForegroundBrush}">

    <Window.Resources>
        <!-- Converter for enum display -->
        <ObjectDataProvider x:Key="SoundTypeValues" MethodName="GetValues" ObjectType="{x:Type services:MetronomeSoundType}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="services:MetronomeSoundType"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </Window.Resources>

    <Grid Margin="0">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" Padding="20">
            <StackPanel>
                <!-- Enable/Disable Section -->
                <TextBlock Text="Metronome"
                           FontWeight="SemiBold"
                           FontSize="14"
                           Margin="0,0,0,15"
                           Foreground="{DynamicResource BrightForegroundBrush}"/>

                <CheckBox Content="Enable Metronome"
                          IsChecked="{Binding IsEnabled, Mode=TwoWay}"
                          Margin="0,0,0,20"
                          FontSize="13"/>

                <Separator Background="{DynamicResource BorderBrush}" Margin="0,0,0,20"/>

                <!-- Volume Section -->
                <TextBlock Text="Volume"
                           FontWeight="SemiBold"
                           FontSize="14"
                           Margin="0,0,0,15"
                           Foreground="{DynamicResource BrightForegroundBrush}"/>

                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="60"/>
                    </Grid.ColumnDefinitions>
                    <Slider Grid.Column="0"
                            Minimum="0" Maximum="1"
                            Value="{Binding Volume, Mode=TwoWay}"
                            TickFrequency="0.1"
                            IsSnapToTickEnabled="False"
                            VerticalAlignment="Center"/>
                    <TextBlock Grid.Column="1"
                               Text="{Binding Volume, StringFormat={}{0:P0}}"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Right"
                               Margin="10,0,0,0"/>
                </Grid>

                <Separator Background="{DynamicResource BorderBrush}" Margin="0,0,0,20"/>

                <!-- Sound Type Section -->
                <TextBlock Text="Click Sound"
                           FontWeight="SemiBold"
                           FontSize="14"
                           Margin="0,0,0,15"
                           Foreground="{DynamicResource BrightForegroundBrush}"/>

                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Sound Type:" VerticalAlignment="Center"/>
                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding SoundTypes}"
                              SelectedItem="{Binding SoundType, Mode=TwoWay}"
                              Background="{DynamicResource EditorBackgroundBrush}"
                              Foreground="{DynamicResource ForegroundBrush}"
                              BorderBrush="{DynamicResource BorderBrush}"/>
                </Grid>

                <!-- Custom Sound (only visible when Custom is selected) -->
                <StackPanel Visibility="{Binding IsCustomSoundSelected, Converter={StaticResource BooleanToVisibilityConverter}}"
                            Margin="0,0,0,15">
                    <TextBlock Text="Custom Click Sound:" Margin="0,0,0,5"/>
                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0"
                                 Text="{Binding CustomSoundPath, Mode=TwoWay}"
                                 IsReadOnly="True"
                                 Background="{DynamicResource EditorBackgroundBrush}"
                                 Foreground="{DynamicResource ForegroundBrush}"
                                 BorderBrush="{DynamicResource BorderBrush}"
                                 Padding="8,6"/>
                        <Button Grid.Column="1"
                                Content="Browse..."
                                Command="{Binding BrowseCustomSoundCommand}"
                                Padding="12,6"
                                Margin="5,0,0,0"/>
                    </Grid>

                    <TextBlock Text="Custom Accent Sound (optional):" Margin="0,0,0,5"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0"
                                 Text="{Binding CustomAccentSoundPath, Mode=TwoWay}"
                                 IsReadOnly="True"
                                 Background="{DynamicResource EditorBackgroundBrush}"
                                 Foreground="{DynamicResource ForegroundBrush}"
                                 BorderBrush="{DynamicResource BorderBrush}"
                                 Padding="8,6"/>
                        <Button Grid.Column="1"
                                Content="Browse..."
                                Command="{Binding BrowseCustomAccentSoundCommand}"
                                Padding="12,6"
                                Margin="5,0,0,0"/>
                        <Button Grid.Column="2"
                                Content="Clear"
                                Command="{Binding ClearCustomSoundsCommand}"
                                Padding="12,6"
                                Margin="5,0,0,0"/>
                    </Grid>
                </StackPanel>

                <!-- Preview Button -->
                <Button Content="Preview Click"
                        Command="{Binding PreviewCommand}"
                        HorizontalAlignment="Left"
                        Padding="15,8"
                        Margin="0,0,0,15"/>

                <Separator Background="{DynamicResource BorderBrush}" Margin="0,0,0,20"/>

                <!-- Accent Section -->
                <TextBlock Text="Accent"
                           FontWeight="SemiBold"
                           FontSize="14"
                           Margin="0,0,0,15"
                           Foreground="{DynamicResource BrightForegroundBrush}"/>

                <CheckBox Content="Accent first beat (downbeat)"
                          IsChecked="{Binding AccentEnabled, Mode=TwoWay}"
                          Margin="0,0,0,15"/>

                <Grid Margin="0,0,0,20"
                      IsEnabled="{Binding AccentEnabled}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="60"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Accent Volume:" VerticalAlignment="Center"/>
                    <Slider Grid.Column="1"
                            Minimum="1" Maximum="3"
                            Value="{Binding AccentVolume, Mode=TwoWay}"
                            TickFrequency="0.1"
                            IsSnapToTickEnabled="False"
                            VerticalAlignment="Center"/>
                    <TextBlock Grid.Column="2"
                               Text="{Binding AccentVolume, StringFormat={}{0:F1}x}"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Right"
                               Margin="10,0,0,0"/>
                </Grid>

                <Separator Background="{DynamicResource BorderBrush}" Margin="0,0,0,20"/>

                <!-- Time Signature Section -->
                <TextBlock Text="Time Signature"
                           FontWeight="SemiBold"
                           FontSize="14"
                           Margin="0,0,0,15"
                           Foreground="{DynamicResource BrightForegroundBrush}"/>

                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="100"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Beats per bar:" VerticalAlignment="Center"/>
                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding BeatsPerBarOptions}"
                              SelectedItem="{Binding BeatsPerBar, Mode=TwoWay}"
                              Background="{DynamicResource EditorBackgroundBrush}"
                              Foreground="{DynamicResource ForegroundBrush}"
                              BorderBrush="{DynamicResource BorderBrush}"/>
                </Grid>

                <Separator Background="{DynamicResource BorderBrush}" Margin="0,0,0,20"/>

                <!-- Count-In Section -->
                <TextBlock Text="Count-In"
                           FontWeight="SemiBold"
                           FontSize="14"
                           Margin="0,0,0,15"
                           Foreground="{DynamicResource BrightForegroundBrush}"/>

                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Count-in bars:" VerticalAlignment="Center"/>
                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding CountInOptions}"
                              SelectedItem="{Binding CountInBars, Mode=TwoWay}"
                              Background="{DynamicResource EditorBackgroundBrush}"
                              Foreground="{DynamicResource ForegroundBrush}"
                              BorderBrush="{DynamicResource BorderBrush}"/>
                    <TextBlock Grid.Column="2"
                               Text="(0 = disabled)"
                               VerticalAlignment="Center"
                               Margin="10,0,0,0"
                               Foreground="{DynamicResource SecondaryForegroundBrush}"/>
                </Grid>

                <!-- Info text -->
                <Border Background="{DynamicResource PanelBackgroundBrush}"
                        CornerRadius="4"
                        Padding="12"
                        Margin="0,10,0,0">
                    <TextBlock TextWrapping="Wrap"
                               Foreground="{DynamicResource SecondaryForegroundBrush}"
                               FontSize="11">
                        <Run FontWeight="SemiBold">Tip:</Run>
                        <Run Text=" The metronome will sync with the sequencer's tempo and position. Count-in plays click beats before playback starts."/>
                    </TextBlock>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Bottom Button Panel -->
        <Border Grid.Row="1"
                Background="{DynamicResource PanelBackgroundBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="20,15">
            <Grid>
                <Button Content="Reset to Defaults"
                        Command="{Binding ResetToDefaultsCommand}"
                        HorizontalAlignment="Left"
                        Padding="15,8"/>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="OK"
                            IsDefault="True"
                            Command="{Binding ApplyCommand}"
                            Padding="20,8"
                            Margin="0,0,10,0"
                            Background="{DynamicResource AccentBrush}"
                            Foreground="White"/>
                    <Button Content="Cancel"
                            IsCancel="True"
                            Command="{Binding CancelCommand}"
                            Padding="20,8"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
