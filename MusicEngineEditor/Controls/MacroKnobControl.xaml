<UserControl x:Class="MusicEngineEditor.Controls.MacroKnobControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:MusicEngineEditor.Controls"
             mc:Ignorable="d"
             d:DesignHeight="100" d:DesignWidth="80"
             MinWidth="60"
             MinHeight="80">

    <UserControl.Resources>
        <!-- Colors -->
        <Color x:Key="KnobBackgroundColor">#2B2D30</Color>
        <Color x:Key="KnobBorderColor">#393B40</Color>
        <Color x:Key="KnobTrackColor">#1A1A1A</Color>
        <Color x:Key="TextPrimaryColor">#BCBEC4</Color>
        <Color x:Key="TextSecondaryColor">#6F737A</Color>
        <Color x:Key="ActiveColor">#55AAFF</Color>
        <Color x:Key="LearningColor">#FF9500</Color>

        <!-- Brushes -->
        <SolidColorBrush x:Key="KnobBackgroundBrush" Color="{StaticResource KnobBackgroundColor}"/>
        <SolidColorBrush x:Key="KnobBorderBrush" Color="{StaticResource KnobBorderColor}"/>
        <SolidColorBrush x:Key="KnobTrackBrush" Color="{StaticResource KnobTrackColor}"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="{StaticResource TextPrimaryColor}"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="{StaticResource TextSecondaryColor}"/>
        <SolidColorBrush x:Key="ActiveBrush" Color="{StaticResource ActiveColor}"/>
        <SolidColorBrush x:Key="LearningBrush" Color="{StaticResource LearningColor}"/>

        <!-- Knob Glow Effect -->
        <DropShadowEffect x:Key="KnobGlowEffect"
                          Color="#55AAFF"
                          BlurRadius="10"
                          ShadowDepth="0"
                          Opacity="0.5"/>

        <!-- Learning Glow Effect -->
        <DropShadowEffect x:Key="LearningGlowEffect"
                          Color="#FF9500"
                          BlurRadius="12"
                          ShadowDepth="0"
                          Opacity="0.7"/>
    </UserControl.Resources>

    <UserControl.ContextMenu>
        <ContextMenu>
            <MenuItem Header="Add Mapping..." Click="AddMapping_Click"/>
            <MenuItem Header="Edit Mappings..." Click="EditMappings_Click"/>
            <Separator/>
            <MenuItem Header="MIDI Learn" Click="MidiLearn_Click"/>
            <MenuItem Header="Clear MIDI" Click="ClearMidi_Click"/>
            <Separator/>
            <MenuItem Header="Reset to Default" Click="Reset_Click"/>
            <MenuItem Header="Set as Default" Click="SetDefault_Click"/>
            <Separator/>
            <MenuItem Header="Clear All Mappings" Click="ClearMappings_Click"/>
        </ContextMenu>
    </UserControl.ContextMenu>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Macro Name -->
        <TextBlock x:Name="MacroNameText"
                   Grid.Row="0"
                   Text="{Binding MacroName, RelativeSource={RelativeSource AncestorType=UserControl}}"
                   Foreground="{StaticResource TextPrimaryBrush}"
                   FontSize="10"
                   FontWeight="SemiBold"
                   TextTrimming="CharacterEllipsis"
                   HorizontalAlignment="Center"
                   Margin="0,0,0,4"/>

        <!-- Knob Container -->
        <Grid Grid.Row="1"
              HorizontalAlignment="Center"
              VerticalAlignment="Center">

            <!-- Knob Track (background arc) -->
            <Canvas x:Name="KnobCanvas"
                    Width="50" Height="50"
                    ClipToBounds="False">

                <!-- Track Arc (full range) -->
                <Path x:Name="TrackArc"
                      Stroke="{StaticResource KnobTrackBrush}"
                      StrokeThickness="4"
                      StrokeStartLineCap="Round"
                      StrokeEndLineCap="Round"/>

                <!-- Value Arc (current value) -->
                <Path x:Name="ValueArc"
                      StrokeThickness="4"
                      StrokeStartLineCap="Round"
                      StrokeEndLineCap="Round"/>

                <!-- Knob Body -->
                <Ellipse x:Name="KnobBody"
                         Width="36" Height="36"
                         Canvas.Left="7" Canvas.Top="7"
                         Cursor="Hand"
                         MouseLeftButtonDown="Knob_MouseLeftButtonDown"
                         MouseLeftButtonUp="Knob_MouseLeftButtonUp"
                         MouseMove="Knob_MouseMove"
                         MouseWheel="Knob_MouseWheel">
                    <Ellipse.Fill>
                        <RadialGradientBrush>
                            <GradientStop Color="#4B4D52" Offset="0"/>
                            <GradientStop Color="#3C3E42" Offset="0.5"/>
                            <GradientStop Color="#2B2D30" Offset="1"/>
                        </RadialGradientBrush>
                    </Ellipse.Fill>
                    <Ellipse.Stroke>
                        <SolidColorBrush Color="{StaticResource KnobBorderColor}"/>
                    </Ellipse.Stroke>
                    <Ellipse.StrokeThickness>1</Ellipse.StrokeThickness>
                </Ellipse>

                <!-- Knob Indicator -->
                <Line x:Name="KnobIndicator"
                      X1="25" Y1="25"
                      X2="25" Y2="10"
                      StrokeThickness="3"
                      StrokeStartLineCap="Round"
                      StrokeEndLineCap="Round"/>

                <!-- Mapping Count Badge -->
                <Border x:Name="MappingBadge"
                        Canvas.Right="-2" Canvas.Top="-2"
                        Background="#55AAFF"
                        CornerRadius="6"
                        MinWidth="14" Height="14"
                        Padding="2,0"
                        Visibility="Collapsed">
                    <TextBlock x:Name="MappingCountText"
                               Text="0"
                               Foreground="White"
                               FontSize="9"
                               FontWeight="Bold"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                </Border>

                <!-- Learning Indicator -->
                <Ellipse x:Name="LearningIndicator"
                         Width="8" Height="8"
                         Fill="{StaticResource LearningBrush}"
                         Canvas.Left="21" Canvas.Top="-4"
                         Visibility="Collapsed">
                    <Ellipse.Effect>
                        <DropShadowEffect Color="#FF9500"
                                          BlurRadius="6"
                                          ShadowDepth="0"
                                          Opacity="1"/>
                    </Ellipse.Effect>
                </Ellipse>
            </Canvas>
        </Grid>

        <!-- Value Display -->
        <TextBlock x:Name="ValueText"
                   Grid.Row="2"
                   Foreground="{StaticResource TextSecondaryBrush}"
                   FontSize="10"
                   FontFamily="Consolas"
                   HorizontalAlignment="Center"
                   Margin="0,2,0,0"/>

        <!-- MIDI CC Display -->
        <TextBlock x:Name="MidiCCText"
                   Grid.Row="3"
                   Foreground="{StaticResource TextSecondaryBrush}"
                   FontSize="8"
                   HorizontalAlignment="Center"
                   Margin="0,1,0,0"
                   Visibility="Collapsed"/>
    </Grid>
</UserControl>
