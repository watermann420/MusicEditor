<UserControl x:Class="MusicEngineEditor.Controls.AudioAlignmentControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="350" d:DesignWidth="500"
             Background="#1E1F22"
             MinHeight="300"
             MinWidth="400">

    <UserControl.Resources>
        <!-- Colors -->
        <Color x:Key="BackgroundColor">#1E1F22</Color>
        <Color x:Key="PanelBackgroundColor">#2B2D30</Color>
        <Color x:Key="BorderColor">#393B40</Color>
        <Color x:Key="TextPrimaryColor">#BCBEC4</Color>
        <Color x:Key="TextSecondaryColor">#6F737A</Color>
        <Color x:Key="AccentColor">#55AAFF</Color>
        <Color x:Key="ReferenceColor">#4CAF50</Color>
        <Color x:Key="TargetColor">#FF9800</Color>
        <Color x:Key="AlignedColor">#9C27B0</Color>

        <!-- Brushes -->
        <SolidColorBrush x:Key="BackgroundBrush" Color="{StaticResource BackgroundColor}"/>
        <SolidColorBrush x:Key="PanelBackgroundBrush" Color="{StaticResource PanelBackgroundColor}"/>
        <SolidColorBrush x:Key="BorderBrush" Color="{StaticResource BorderColor}"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="{StaticResource TextPrimaryColor}"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="{StaticResource TextSecondaryColor}"/>
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}"/>
        <SolidColorBrush x:Key="ReferenceBrush" Color="{StaticResource ReferenceColor}"/>
        <SolidColorBrush x:Key="TargetBrush" Color="{StaticResource TargetColor}"/>
        <SolidColorBrush x:Key="AlignedBrush" Color="{StaticResource AlignedColor}"/>
    </UserControl.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock Text="Audio Alignment" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>
            <TextBlock Text="Align audio takes to a reference track using cross-correlation" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,4,0,0"/>
        </StackPanel>

        <!-- Track Selection -->
        <Border Grid.Row="1" Background="{StaticResource PanelBackgroundBrush}" CornerRadius="6" Padding="12" Margin="0,0,0,12">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Reference Track -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <Border Width="12" Height="12" Background="{StaticResource ReferenceBrush}" CornerRadius="2" Margin="0,0,8,0" VerticalAlignment="Center"/>
                    <TextBlock Text="Reference:" VerticalAlignment="Center" Width="80"/>
                </StackPanel>
                <ComboBox Grid.Column="1" x:Name="ReferenceTrackCombo" Margin="0,0,8,8"
                          Background="{StaticResource BackgroundBrush}" Foreground="{StaticResource TextPrimaryBrush}"
                          BorderBrush="{StaticResource BorderBrush}" SelectionChanged="ReferenceTrack_Changed">
                    <ComboBoxItem Content="(Select reference track)"/>
                </ComboBox>
                <Button Grid.Column="2" Content="Set as Ref" Click="SetAsReference_Click" Padding="8,4" Margin="0,0,0,8"
                        Background="{StaticResource ReferenceBrush}" Foreground="White" BorderBrush="{StaticResource ReferenceBrush}"/>

                <!-- Target Tracks -->
                <StackPanel Grid.Row="1" Orientation="Horizontal">
                    <Border Width="12" Height="12" Background="{StaticResource TargetBrush}" CornerRadius="2" Margin="0,0,8,0" VerticalAlignment="Center"/>
                    <TextBlock Text="Targets:" VerticalAlignment="Center" Width="80"/>
                </StackPanel>
                <TextBlock Grid.Row="1" Grid.Column="1" x:Name="TargetTracksText" Text="0 tracks selected"
                           VerticalAlignment="Center" Foreground="{StaticResource TextSecondaryBrush}"/>
            </Grid>
        </Border>

        <!-- Waveform Comparison Display -->
        <Border Grid.Row="2" Background="{StaticResource PanelBackgroundBrush}" CornerRadius="6" Padding="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Reference Waveform -->
                <Border Background="{StaticResource BackgroundBrush}" CornerRadius="4" Margin="0,0,0,4">
                    <Grid>
                        <Canvas x:Name="ReferenceWaveformCanvas" ClipToBounds="True"/>
                        <TextBlock Text="Reference" FontSize="10" Foreground="{StaticResource ReferenceBrush}"
                                   HorizontalAlignment="Left" VerticalAlignment="Top" Margin="4"/>
                    </Grid>
                </Border>

                <!-- Target Waveform (with alignment offset) -->
                <Border Grid.Row="1" Background="{StaticResource BackgroundBrush}" CornerRadius="4" Margin="0,4,0,0">
                    <Grid>
                        <Canvas x:Name="TargetWaveformCanvas" ClipToBounds="True"/>
                        <Canvas x:Name="AlignedWaveformCanvas" ClipToBounds="True"/>
                        <TextBlock Text="Target (orange) / Aligned (purple)" FontSize="10" Foreground="{StaticResource TargetBrush}"
                                   HorizontalAlignment="Left" VerticalAlignment="Top" Margin="4"/>
                    </Grid>
                </Border>

                <!-- Correlation Display -->
                <Border Grid.Row="2" Background="{StaticResource BackgroundBrush}" CornerRadius="4" Height="40" Margin="0,8,0,0">
                    <Grid>
                        <Canvas x:Name="CorrelationCanvas" ClipToBounds="True"/>
                        <TextBlock Text="Cross-correlation" FontSize="9" Foreground="{StaticResource TextSecondaryBrush}"
                                   HorizontalAlignment="Left" VerticalAlignment="Top" Margin="4,2"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- Settings Panel -->
        <Border Grid.Row="3" Background="{StaticResource PanelBackgroundBrush}" CornerRadius="6" Padding="12" Margin="0,12,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Max Search Range -->
                <StackPanel Orientation="Horizontal" Margin="0,0,8,8">
                    <TextBlock Text="Max offset:" VerticalAlignment="Center" Width="80"/>
                    <TextBox x:Name="MaxOffsetBox" Width="60" Text="500" TextAlignment="Center"
                             Background="{StaticResource BackgroundBrush}" Foreground="{StaticResource TextPrimaryBrush}"
                             BorderBrush="{StaticResource BorderBrush}" Padding="4,2"/>
                    <TextBlock Text="ms" VerticalAlignment="Center" Margin="4,0,0,0" Foreground="{StaticResource TextSecondaryBrush}"/>
                </StackPanel>

                <!-- Analysis Region -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="8,0,0,8">
                    <TextBlock Text="Analysis:" VerticalAlignment="Center" Width="80"/>
                    <ComboBox x:Name="AnalysisRegionCombo" Width="100"
                              Background="{StaticResource BackgroundBrush}" Foreground="{StaticResource TextPrimaryBrush}"
                              BorderBrush="{StaticResource BorderBrush}">
                        <ComboBoxItem Content="Entire clip" IsSelected="True"/>
                        <ComboBoxItem Content="First 5s"/>
                        <ComboBoxItem Content="Selection"/>
                    </ComboBox>
                </StackPanel>

                <!-- Time Stretch Option -->
                <CheckBox Grid.Row="1" x:Name="TimeStretchCheck" Content="Time-stretch to match tempo" Margin="0,0,0,8"/>

                <!-- Sample Accuracy -->
                <CheckBox Grid.Row="1" Grid.Column="1" x:Name="SampleAccuracyCheck" Content="Sample-accurate alignment" IsChecked="True" Margin="8,0,0,8"/>

                <!-- Results -->
                <Border Grid.Row="2" Grid.ColumnSpan="2" Background="{StaticResource BackgroundBrush}" CornerRadius="4" Padding="8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel>
                            <TextBlock Text="Offset" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}"/>
                            <TextBlock x:Name="OffsetResultText" Text="-- ms" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource AccentBrush}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                            <TextBlock Text="Correlation" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}"/>
                            <TextBlock x:Name="CorrelationResultText" Text="-- %" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource AccentBrush}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2" HorizontalAlignment="Right">
                            <TextBlock Text="Samples" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}"/>
                            <TextBlock x:Name="SamplesResultText" Text="--" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource AccentBrush}"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- Action Buttons -->
        <Grid Grid.Row="4" Margin="0,12,0,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                <Button x:Name="AnalyzeButton" Content="Analyze" Click="Analyze_Click" Padding="16,8" Margin="0,0,8,0"
                        Background="{StaticResource AccentBrush}" Foreground="White" BorderBrush="{StaticResource AccentBrush}"/>
                <Button Content="Preview" Click="Preview_Click" Padding="16,8" Margin="0,0,8,0"
                        Background="{StaticResource PanelBackgroundBrush}" Foreground="{StaticResource TextPrimaryBrush}"
                        BorderBrush="{StaticResource BorderBrush}"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="Apply" Click="Apply_Click" Padding="20,8" Margin="0,0,8,0"
                        Background="{StaticResource AccentBrush}" Foreground="White" BorderBrush="{StaticResource AccentBrush}"/>
                <Button Content="Reset" Click="Reset_Click" Padding="16,8"
                        Background="{StaticResource PanelBackgroundBrush}" Foreground="{StaticResource TextPrimaryBrush}"
                        BorderBrush="{StaticResource BorderBrush}"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
