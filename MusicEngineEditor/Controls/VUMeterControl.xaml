<UserControl x:Class="MusicEngineEditor.Controls.VUMeterControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="180" d:DesignWidth="200"
             Background="#1E1F22"
             MinWidth="120"
             MinHeight="100">

    <UserControl.Resources>
        <!-- Dark theme colors -->
        <Color x:Key="MeterBackgroundColor">#1E1F22</Color>
        <Color x:Key="MeterFaceColor">#2B2D30</Color>
        <Color x:Key="MeterBorderColor">#393B40</Color>
        <Color x:Key="TextPrimaryColor">#BCBEC4</Color>
        <Color x:Key="TextSecondaryColor">#6F737A</Color>
        <Color x:Key="NeedleColor">#FF6B6B</Color>
        <Color x:Key="NeedleShadowColor">#40000000</Color>
        <Color x:Key="ScaleLineColor">#6F737A</Color>
        <Color x:Key="ZeroMarkColor">#FF9500</Color>
        <Color x:Key="PeakLedOnColor">#FF3333</Color>
        <Color x:Key="PeakLedOffColor">#4D1A1A</Color>
        <Color x:Key="VuGreenZoneColor">#00AA00</Color>
        <Color x:Key="VuYellowZoneColor">#CCAA00</Color>
        <Color x:Key="VuRedZoneColor">#CC0000</Color>

        <!-- Brushes -->
        <SolidColorBrush x:Key="MeterBackgroundBrush" Color="{StaticResource MeterBackgroundColor}"/>
        <SolidColorBrush x:Key="MeterFaceBrush" Color="{StaticResource MeterFaceColor}"/>
        <SolidColorBrush x:Key="MeterBorderBrush" Color="{StaticResource MeterBorderColor}"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="{StaticResource TextPrimaryColor}"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="{StaticResource TextSecondaryColor}"/>
        <SolidColorBrush x:Key="NeedleBrush" Color="{StaticResource NeedleColor}"/>
        <SolidColorBrush x:Key="NeedleShadowBrush" Color="{StaticResource NeedleShadowColor}"/>
        <SolidColorBrush x:Key="ScaleLineBrush" Color="{StaticResource ScaleLineColor}"/>
        <SolidColorBrush x:Key="ZeroMarkBrush" Color="{StaticResource ZeroMarkColor}"/>
        <SolidColorBrush x:Key="PeakLedOnBrush" Color="{StaticResource PeakLedOnColor}"/>
        <SolidColorBrush x:Key="PeakLedOffBrush" Color="{StaticResource PeakLedOffColor}"/>

        <!-- VU face gradient -->
        <RadialGradientBrush x:Key="MeterFaceGradientBrush"
                             GradientOrigin="0.5,0.3"
                             Center="0.5,0.5">
            <GradientStop Color="#3A3C40" Offset="0"/>
            <GradientStop Color="#2B2D30" Offset="0.7"/>
            <GradientStop Color="#232528" Offset="1"/>
        </RadialGradientBrush>

        <!-- Glow effect for peak LED -->
        <DropShadowEffect x:Key="PeakGlowEffect"
                          Color="#FF3333"
                          BlurRadius="10"
                          ShadowDepth="0"
                          Opacity="0.9"/>
    </UserControl.Resources>

    <Border Background="{StaticResource MeterBackgroundBrush}"
            BorderBrush="{StaticResource MeterBorderBrush}"
            BorderThickness="1"
            CornerRadius="6"
            Padding="8">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header with mode indicator -->
            <Grid Grid.Row="0" Margin="0,0,0,4">
                <TextBlock Text="VU"
                           FontSize="11"
                           FontWeight="Bold"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           HorizontalAlignment="Left"/>

                <!-- Channel indicator (L/R or Mono) -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock x:Name="ChannelLabel"
                               Text="L/R"
                               FontSize="10"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               Margin="0,0,8,0"/>

                    <!-- Peak LED indicator -->
                    <Ellipse x:Name="PeakLed"
                             Width="10"
                             Height="10"
                             Fill="{StaticResource PeakLedOffBrush}"
                             Stroke="#602020"
                             StrokeThickness="1"
                             ToolTip="Peak Indicator - Click to reset"/>
                </StackPanel>
            </Grid>

            <!-- VU Meter Face -->
            <Border Grid.Row="1"
                    Background="{StaticResource MeterFaceGradientBrush}"
                    BorderBrush="{StaticResource MeterBorderBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Margin="0,4"
                    ClipToBounds="True">
                <Canvas x:Name="MeterCanvas" Margin="8">
                    <!-- Scale arc and markings drawn in code-behind -->

                    <!-- Needle shadow (drawn below needle for depth) -->
                    <Path x:Name="NeedleShadow"
                          Fill="{StaticResource NeedleShadowBrush}"
                          RenderTransformOrigin="0.5,1">
                        <Path.RenderTransform>
                            <RotateTransform x:Name="NeedleShadowRotation" Angle="-45"/>
                        </Path.RenderTransform>
                    </Path>

                    <!-- Needle -->
                    <Path x:Name="Needle"
                          Fill="{StaticResource NeedleBrush}"
                          RenderTransformOrigin="0.5,1">
                        <Path.RenderTransform>
                            <RotateTransform x:Name="NeedleRotation" Angle="-45"/>
                        </Path.RenderTransform>
                    </Path>

                    <!-- Needle pivot point -->
                    <Ellipse x:Name="NeedlePivot"
                             Width="8"
                             Height="8"
                             Fill="#505050"
                             Stroke="#303030"
                             StrokeThickness="1"/>
                </Canvas>
            </Border>

            <!-- Footer with dB readout -->
            <Grid Grid.Row="2" Margin="0,4,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left channel dB display -->
                <Border Grid.Column="0"
                        Background="#1A1B1E"
                        CornerRadius="3"
                        Padding="4,2"
                        HorizontalAlignment="Stretch"
                        Margin="0,0,2,0">
                    <TextBlock x:Name="LeftDbText"
                               Text="-20.0"
                               FontSize="11"
                               FontFamily="Consolas"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               HorizontalAlignment="Center"/>
                </Border>

                <!-- VU label -->
                <TextBlock Grid.Column="1"
                           Text="VU"
                           FontSize="9"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           VerticalAlignment="Center"
                           Margin="4,0"/>

                <!-- Right channel dB display (hidden in mono mode) -->
                <Border x:Name="RightDbPanel"
                        Grid.Column="2"
                        Background="#1A1B1E"
                        CornerRadius="3"
                        Padding="4,2"
                        HorizontalAlignment="Stretch"
                        Margin="2,0,0,0">
                    <TextBlock x:Name="RightDbText"
                               Text="-20.0"
                               FontSize="11"
                               FontFamily="Consolas"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               HorizontalAlignment="Center"/>
                </Border>
            </Grid>
        </Grid>
    </Border>
</UserControl>
