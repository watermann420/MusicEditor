<UserControl x:Class="MusicEngineEditor.Controls.ProjectNotesPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="300" d:DesignWidth="400"
             Background="{DynamicResource PanelBackgroundBrush}">

    <UserControl.Resources>
        <!-- Toolbar Button Style -->
        <Style x:Key="NotesToolbarButtonStyle" TargetType="ToggleButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource SecondaryForegroundBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="28"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="3"
                                Padding="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#252525"/>
                                <Setter Property="Foreground" Value="{DynamicResource BrightForegroundBrush}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#214283"/>
                                <Setter Property="Foreground" Value="#4B9EFF"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="{DynamicResource DisabledForegroundBrush}"/>
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Regular Button Style for Toolbar -->
        <Style x:Key="NotesToolbarActionButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource SecondaryForegroundBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="28"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="3"
                                Padding="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#252525"/>
                                <Setter Property="Foreground" Value="{DynamicResource BrightForegroundBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#00D9FF"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="{DynamicResource DisabledForegroundBrush}"/>
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Toolbar Separator -->
        <Style x:Key="NotesToolbarSeparatorStyle" TargetType="Border">
            <Setter Property="Width" Value="1"/>
            <Setter Property="Background" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="Margin" Value="4,4"/>
        </Style>
    </UserControl.Resources>

    <Border BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="6">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0"
                    Background="{DynamicResource BackgroundBrush}"
                    BorderBrush="{DynamicResource BorderBrush}"
                    BorderThickness="0,0,0,1"
                    Padding="12,8">
                <Grid>
                    <TextBlock Text="Project Notes"
                               FontSize="13"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource BrightForegroundBrush}"
                               VerticalAlignment="Center"/>

                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center">
                        <Button x:Name="ClearButton"
                                Style="{StaticResource NotesToolbarActionButtonStyle}"
                                Click="ClearButton_Click"
                                ToolTip="Clear All Notes">
                            <Path Data="M 2,2 L 10,10 M 10,2 L 2,10"
                                  Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                                  StrokeThickness="1.5"
                                  Width="12" Height="12"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Formatting Toolbar -->
            <Border Grid.Row="1"
                    Background="{DynamicResource BackgroundBrush}"
                    BorderBrush="{DynamicResource BorderBrush}"
                    BorderThickness="0,0,0,1"
                    Padding="8,4">
                <StackPanel Orientation="Horizontal">
                    <!-- Bold -->
                    <ToggleButton x:Name="BoldButton"
                                  Style="{StaticResource NotesToolbarButtonStyle}"
                                  Click="BoldButton_Click"
                                  ToolTip="Bold (Ctrl+B)">
                        <TextBlock Text="B" FontWeight="Bold" FontSize="12"/>
                    </ToggleButton>

                    <!-- Italic -->
                    <ToggleButton x:Name="ItalicButton"
                                  Style="{StaticResource NotesToolbarButtonStyle}"
                                  Click="ItalicButton_Click"
                                  ToolTip="Italic (Ctrl+I)">
                        <TextBlock Text="I" FontStyle="Italic" FontSize="12"/>
                    </ToggleButton>

                    <!-- Underline -->
                    <ToggleButton x:Name="UnderlineButton"
                                  Style="{StaticResource NotesToolbarButtonStyle}"
                                  Click="UnderlineButton_Click"
                                  ToolTip="Underline (Ctrl+U)">
                        <TextBlock Text="U" FontSize="12">
                            <TextBlock.TextDecorations>
                                <TextDecoration Location="Underline"/>
                            </TextBlock.TextDecorations>
                        </TextBlock>
                    </ToggleButton>

                    <!-- Separator -->
                    <Border Style="{StaticResource NotesToolbarSeparatorStyle}"/>

                    <!-- Bullet List -->
                    <Button x:Name="BulletListButton"
                            Style="{StaticResource NotesToolbarActionButtonStyle}"
                            Click="BulletListButton_Click"
                            ToolTip="Insert Bullet Point">
                        <Path Data="M 0,3 L 4,3 M 6,3 L 12,3 M 0,7 L 4,7 M 6,7 L 12,7 M 0,11 L 4,11 M 6,11 L 12,11"
                              Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                              Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                              StrokeThickness="1"
                              Width="12" Height="14"/>
                    </Button>
                </StackPanel>
            </Border>

            <!-- Rich Text Editor -->
            <RichTextBox x:Name="NotesRichTextBox"
                         Grid.Row="2"
                         Background="{DynamicResource EditorBackgroundBrush}"
                         Foreground="{DynamicResource ForegroundBrush}"
                         BorderThickness="0"
                         Padding="12,8"
                         AcceptsReturn="True"
                         AcceptsTab="True"
                         VerticalScrollBarVisibility="Auto"
                         SelectionChanged="NotesRichTextBox_SelectionChanged"
                         TextChanged="NotesRichTextBox_TextChanged"
                         PreviewKeyDown="NotesRichTextBox_PreviewKeyDown">
                <RichTextBox.Resources>
                    <Style TargetType="Paragraph">
                        <Setter Property="Margin" Value="0,0,0,4"/>
                    </Style>
                </RichTextBox.Resources>
                <FlowDocument x:Name="NotesDocument">
                    <Paragraph>
                        <Run Text=""/>
                    </Paragraph>
                </FlowDocument>
            </RichTextBox>

            <!-- Status Bar -->
            <Border Grid.Row="3"
                    Background="{DynamicResource BackgroundBrush}"
                    BorderBrush="{DynamicResource BorderBrush}"
                    BorderThickness="0,1,0,0"
                    Padding="12,4">
                <Grid>
                    <TextBlock x:Name="StatusText"
                               Text="Ready"
                               FontSize="10"
                               Foreground="{DynamicResource SecondaryForegroundBrush}"
                               HorizontalAlignment="Left"/>

                    <TextBlock x:Name="CharCountText"
                               Text="0 characters"
                               FontSize="10"
                               Foreground="{DynamicResource SecondaryForegroundBrush}"
                               HorizontalAlignment="Right"/>
                </Grid>
            </Border>
        </Grid>
    </Border>
</UserControl>
