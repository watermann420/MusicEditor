<UserControl x:Class="MusicEngineEditor.Controls.SampleBrowser"
             x:Name="SampleBrowserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:MusicEngineEditor.Controls"
             xmlns:viewmodels="clr-namespace:MusicEngineEditor.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="500" d:DesignWidth="350"
             Background="{DynamicResource BackgroundBrush}">

    <UserControl.Resources>
        <!-- Category Tab Button Style -->
        <Style x:Key="CategoryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource SecondaryForegroundBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="4"
                                Margin="0,0,4,0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#252525"/>
                                <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
                            </Trigger>
                            <Trigger Property="Tag" Value="Active">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource AccentBrush}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Preview Button Style -->
        <Style x:Key="PreviewButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource SecondaryForegroundBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="28"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="14"
                                Width="28" Height="28">
                            <TextBlock x:Name="icon"
                                       Text="&#x25B6;"
                                       FontSize="10"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Foreground="{TemplateBinding Foreground}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource AccentBrush}"/>
                                <Setter TargetName="icon" Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="Tag" Value="Playing">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource RunButtonBrush}"/>
                                <Setter TargetName="icon" Property="Text" Value="&#x25A0;"/>
                                <Setter TargetName="icon" Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Sample List Item Style -->
        <Style x:Key="SampleListItemStyle" TargetType="ListViewItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Margin" Value="0,1"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="4">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#252525"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource AccentBrush}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Search TextBox Style -->
        <Style x:Key="SearchTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="{DynamicResource InputBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource SubtleBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="CaretBrush" Value="{DynamicResource ForegroundBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0"
                                           Text="&#x1F50D;"
                                           FontSize="12"
                                           Foreground="{DynamicResource SecondaryForegroundBrush}"
                                           VerticalAlignment="Center"
                                           Margin="8,0,4,0"/>
                                <ScrollViewer x:Name="PART_ContentHost"
                                              Grid.Column="1"
                                              Margin="{TemplateBinding Padding}"
                                              VerticalAlignment="Center"/>
                                <TextBlock x:Name="placeholder"
                                           Grid.Column="1"
                                           Text="Search samples..."
                                           FontSize="12"
                                           Foreground="{DynamicResource SecondaryForegroundBrush}"
                                           VerticalAlignment="Center"
                                           Margin="8,0,0,0"
                                           IsHitTestVisible="False"
                                           Visibility="Collapsed"/>
                                <Button x:Name="clearButton"
                                        Grid.Column="2"
                                        Content="&#x2715;"
                                        FontSize="10"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Foreground="{DynamicResource SecondaryForegroundBrush}"
                                        Padding="8,0"
                                        Cursor="Hand"
                                        Visibility="Collapsed"
                                        Click="ClearSearch_Click"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="Text" Value="">
                                <Setter TargetName="placeholder" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="Text" Value="{x:Null}">
                                <Setter TargetName="placeholder" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <DataTrigger Binding="{Binding Text.Length, RelativeSource={RelativeSource Self}}" Value="0">
                                <Setter TargetName="placeholder" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="clearButton" Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                                <Setter TargetName="clearButton" Property="Visibility" Value="Visible"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
                Background="{DynamicResource PanelBackgroundBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,0,0,1"
                Padding="12,10">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="&#x1F3B5;"
                           FontSize="16"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <TextBlock Text="Sample Browser"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource BrightForegroundBrush}"
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Search Box -->
        <Border Grid.Row="1"
                Padding="12,8">
            <TextBox x:Name="SearchTextBox"
                     Style="{StaticResource SearchTextBoxStyle}"
                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                     TextChanged="SearchTextBox_TextChanged"/>
        </Border>

        <!-- Category Tabs -->
        <Border Grid.Row="2"
                Padding="12,4,12,8">
            <StackPanel x:Name="CategoryPanel" Orientation="Horizontal">
                <Button Content="All"
                        Style="{StaticResource CategoryButtonStyle}"
                        Tag="{Binding SelectedCategory, Converter={x:Static local:CategoryTagConverter.Instance}, ConverterParameter=All}"
                        Click="Category_Click"/>
                <Button Content="Drums"
                        Style="{StaticResource CategoryButtonStyle}"
                        Tag="{Binding SelectedCategory, Converter={x:Static local:CategoryTagConverter.Instance}, ConverterParameter=Drums}"
                        Click="Category_Click"/>
                <Button Content="Bass"
                        Style="{StaticResource CategoryButtonStyle}"
                        Tag="{Binding SelectedCategory, Converter={x:Static local:CategoryTagConverter.Instance}, ConverterParameter=Bass}"
                        Click="Category_Click"/>
                <Button Content="Synths"
                        Style="{StaticResource CategoryButtonStyle}"
                        Tag="{Binding SelectedCategory, Converter={x:Static local:CategoryTagConverter.Instance}, ConverterParameter=Synths}"
                        Click="Category_Click"/>
                <Button Content="FX"
                        Style="{StaticResource CategoryButtonStyle}"
                        Tag="{Binding SelectedCategory, Converter={x:Static local:CategoryTagConverter.Instance}, ConverterParameter=FX}"
                        Click="Category_Click"/>
            </StackPanel>
        </Border>

        <!-- Sample List -->
        <ListView Grid.Row="3"
                  x:Name="SampleListView"
                  ItemsSource="{Binding FilteredSamples}"
                  SelectedItem="{Binding SelectedSample}"
                  Background="Transparent"
                  BorderThickness="0"
                  Padding="8,0"
                  ItemContainerStyle="{StaticResource SampleListItemStyle}"
                  MouseDoubleClick="SampleListView_MouseDoubleClick"
                  ScrollViewer.HorizontalScrollBarVisibility="Disabled">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Preview Button -->
                        <Button Grid.Column="0"
                                Style="{StaticResource PreviewButtonStyle}"
                                Tag="{Binding IsPreviewPlaying, ElementName=SampleBrowserControl, Converter={x:Static local:PreviewTagConverter.Instance}}"
                                Click="Preview_Click"
                                Margin="0,0,8,0"/>

                        <!-- Sample Name -->
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="{Binding Name}"
                                       FontSize="12"
                                       FontWeight="Medium"
                                       Foreground="{DynamicResource ForegroundBrush}"
                                       TextTrimming="CharacterEllipsis"/>
                            <TextBlock Text="{Binding Category}"
                                       FontSize="10"
                                       Foreground="{DynamicResource SecondaryForegroundBrush}"
                                       Margin="0,2,0,0"/>
                        </StackPanel>

                        <!-- BPM (if available) -->
                        <TextBlock Grid.Column="2"
                                   Text="{Binding Bpm, StringFormat={}{0:F0} BPM}"
                                   FontSize="10"
                                   Foreground="{DynamicResource SecondaryForegroundBrush}"
                                   VerticalAlignment="Center"
                                   Margin="8,0"
                                   Visibility="{Binding Bpm, Converter={x:Static local:NullToVisibilityConverter.Instance}}"/>

                        <!-- Key (if available) -->
                        <Border Grid.Column="3"
                                Background="{DynamicResource SubtleBorderBrush}"
                                CornerRadius="3"
                                Padding="6,2"
                                Margin="4,0"
                                VerticalAlignment="Center"
                                Visibility="{Binding Key, Converter={x:Static local:NullToVisibilityConverter.Instance}}">
                            <TextBlock Text="{Binding Key}"
                                       FontSize="10"
                                       Foreground="{DynamicResource ForegroundBrush}"/>
                        </Border>

                        <!-- Duration -->
                        <TextBlock Grid.Column="4"
                                   Text="{Binding DurationFormatted}"
                                   FontSize="10"
                                   Foreground="{DynamicResource SecondaryForegroundBrush}"
                                   VerticalAlignment="Center"
                                   Margin="8,0,0,0"
                                   MinWidth="40"
                                   TextAlignment="Right"/>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- Status Bar -->
        <Border Grid.Row="4"
                Background="{DynamicResource PanelBackgroundBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="12,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="{Binding StatusMessage}"
                           FontSize="11"
                           Foreground="{DynamicResource SecondaryForegroundBrush}"
                           VerticalAlignment="Center"/>

                <Button Grid.Column="1"
                        Content="Use Sample"
                        Style="{DynamicResource PrimaryButtonStyle}"
                        Padding="12,4"
                        FontSize="11"
                        Command="{Binding UseSampleCommand}"
                        IsEnabled="{Binding SelectedSample, Converter={x:Static local:NotNullToBoolConverter.Instance}}"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
