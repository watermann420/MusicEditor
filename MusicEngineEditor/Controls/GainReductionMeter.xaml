<UserControl x:Class="MusicEngineEditor.Controls.GainReductionMeter"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="200" d:DesignWidth="60"
             Background="#1E1F22"
             MinWidth="40"
             MinHeight="100">

    <UserControl.Resources>
        <!-- Dark theme colors -->
        <Color x:Key="MeterBackgroundColor">#1E1F22</Color>
        <Color x:Key="MeterTrackColor">#0D0D0D</Color>
        <Color x:Key="MeterBorderColor">#393B40</Color>
        <Color x:Key="TextPrimaryColor">#BCBEC4</Color>
        <Color x:Key="TextSecondaryColor">#6F737A</Color>
        <Color x:Key="GRColor">#FF8C00</Color>
        <Color x:Key="GRDimColor">#332200</Color>
        <Color x:Key="ThresholdLineColor">#FF6B6B</Color>
        <Color x:Key="PeakHoldColor">#FFAA00</Color>

        <!-- Brushes -->
        <SolidColorBrush x:Key="MeterBackgroundBrush" Color="{StaticResource MeterBackgroundColor}"/>
        <SolidColorBrush x:Key="MeterTrackBrush" Color="{StaticResource MeterTrackColor}"/>
        <SolidColorBrush x:Key="MeterBorderBrush" Color="{StaticResource MeterBorderColor}"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="{StaticResource TextPrimaryColor}"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="{StaticResource TextSecondaryColor}"/>
        <SolidColorBrush x:Key="GRBrush" Color="{StaticResource GRColor}"/>
        <SolidColorBrush x:Key="GRDimBrush" Color="{StaticResource GRDimColor}"/>
        <SolidColorBrush x:Key="ThresholdLineBrush" Color="{StaticResource ThresholdLineColor}"/>
        <SolidColorBrush x:Key="PeakHoldBrush" Color="{StaticResource PeakHoldColor}"/>

        <!-- Vertical gradient for GR bar (top to bottom = more compression) -->
        <LinearGradientBrush x:Key="GRGradientBrush" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#FFCC00" Offset="0.0"/>
            <GradientStop Color="#FF8C00" Offset="0.5"/>
            <GradientStop Color="#FF4400" Offset="1.0"/>
        </LinearGradientBrush>

        <!-- Glow effect for active compression -->
        <DropShadowEffect x:Key="GRGlowEffect"
                          Color="#FF8C00"
                          BlurRadius="8"
                          ShadowDepth="0"
                          Opacity="0.6"/>
    </UserControl.Resources>

    <Border Background="{StaticResource MeterBackgroundBrush}"
            BorderBrush="{StaticResource MeterBorderBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Padding="6">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <TextBlock Grid.Row="0"
                       Text="GR"
                       FontSize="11"
                       FontWeight="Bold"
                       Foreground="{StaticResource TextPrimaryBrush}"
                       HorizontalAlignment="Center"
                       Margin="0,0,0,4"
                       ToolTip="Gain Reduction"/>

            <!-- Meter Track -->
            <Grid Grid.Row="1" Margin="0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="18"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Scale -->
                <Canvas x:Name="ScaleCanvas" Grid.Column="0"/>

                <!-- GR Meter -->
                <Border Grid.Column="1"
                        Background="{StaticResource MeterTrackBrush}"
                        BorderBrush="{StaticResource MeterBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="2"
                        ClipToBounds="True">
                    <Grid>
                        <!-- Dim background indicator -->
                        <Border Background="{StaticResource GRDimBrush}"
                                Margin="1"/>

                        <!-- GR bar (grows from top down) -->
                        <Border x:Name="GRBar"
                                Background="{StaticResource GRGradientBrush}"
                                VerticalAlignment="Top"
                                Margin="2"
                                CornerRadius="1"
                                Height="0"/>

                        <!-- Threshold line indicator -->
                        <Rectangle x:Name="ThresholdLine"
                                   Height="2"
                                   Fill="{StaticResource ThresholdLineBrush}"
                                   VerticalAlignment="Top"
                                   Margin="1,0"
                                   Opacity="0.8"
                                   Visibility="Collapsed"/>

                        <!-- Peak hold indicator -->
                        <Rectangle x:Name="PeakHoldLine"
                                   Height="2"
                                   Fill="{StaticResource PeakHoldBrush}"
                                   VerticalAlignment="Top"
                                   Margin="3,0">
                            <Rectangle.Effect>
                                <DropShadowEffect Color="#FFAA00"
                                                  BlurRadius="4"
                                                  ShadowDepth="0"
                                                  Opacity="0.8"/>
                            </Rectangle.Effect>
                        </Rectangle>

                        <!-- Attack/Release visualization overlay -->
                        <Canvas x:Name="DynamicsCanvas"
                                Margin="1"/>
                    </Grid>
                </Border>
            </Grid>

            <!-- Current GR Display -->
            <Border Grid.Row="2"
                    Background="#1A1B1E"
                    CornerRadius="3"
                    Padding="4,2"
                    Margin="0,4,0,0">
                <TextBlock x:Name="GRValueText"
                           Text="0.0 dB"
                           FontSize="11"
                           FontFamily="Consolas"
                           Foreground="{StaticResource GRBrush}"
                           HorizontalAlignment="Center"/>
            </Border>

            <!-- Peak GR Display -->
            <StackPanel Grid.Row="3"
                        Orientation="Horizontal"
                        HorizontalAlignment="Center"
                        Margin="0,4,0,0">
                <TextBlock Text="Peak:"
                           FontSize="9"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           Margin="0,0,4,0"/>
                <TextBlock x:Name="PeakGRText"
                           Text="0.0"
                           FontSize="9"
                           FontFamily="Consolas"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           MouseLeftButtonDown="OnPeakReset"
                           Cursor="Hand"
                           ToolTip="Click to reset peak"/>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
