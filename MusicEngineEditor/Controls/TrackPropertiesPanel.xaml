<UserControl x:Class="MusicEngineEditor.Controls.TrackPropertiesPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:MusicEngineEditor.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="280"
             d:DataContext="{d:DesignInstance Type=vm:TrackPropertiesViewModel}"
             Background="#0D0D0D">

    <UserControl.Resources>
        <!-- Colors matching the dark theme -->
        <SolidColorBrush x:Key="PanelBackgroundBrush" Color="#0D0D0D"/>
        <SolidColorBrush x:Key="CardBackgroundBrush" Color="#181818"/>
        <SolidColorBrush x:Key="CardHoverBrush" Color="#313335"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#2A2A2A"/>
        <SolidColorBrush x:Key="ForegroundBrush" Color="#E0E0E0"/>
        <SolidColorBrush x:Key="SecondaryForegroundBrush" Color="#808080"/>
        <SolidColorBrush x:Key="BrightForegroundBrush" Color="#DFE1E5"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#00D9FF"/>
        <SolidColorBrush x:Key="AccentHoverBrush" Color="#5A7FC4"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#00FF88"/>
        <SolidColorBrush x:Key="WarningBrush" Color="#E8B339"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#F75464"/>
        <SolidColorBrush x:Key="MuteActiveBrush" Color="#FF5555"/>
        <SolidColorBrush x:Key="SoloActiveBrush" Color="#FFDD55"/>
        <SolidColorBrush x:Key="ArmActiveBrush" Color="#FF3333"/>
        <SolidColorBrush x:Key="FrozenBrush" Color="#55DDFF"/>

        <!-- Section Header Style -->
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource SecondaryForegroundBrush}"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
            <Setter Property="Typography.Capitals" Value="AllSmallCaps"/>
        </Style>

        <!-- Property Label Style -->
        <Style x:Key="PropertyLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Foreground" Value="{StaticResource SecondaryForegroundBrush}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- Property Value Style -->
        <Style x:Key="PropertyValueStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- Text Input Style -->
        <Style x:Key="PropertyTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#252628"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="CaretBrush" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ScrollViewer x:Name="PART_ContentHost" Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Toggle Button Style for M/S/R/F -->
        <Style x:Key="TrackToggleButtonStyle" TargetType="ToggleButton">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="Background" Value="#3C3F44"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="4">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Opacity" Value="0.85"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Opacity" Value="0.7"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Small Action Button Style -->
        <Style x:Key="SmallActionButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#3C3F44"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#4A4D52"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Danger Button Style (Delete) -->
        <Style x:Key="DangerButtonStyle" TargetType="Button" BasedOn="{StaticResource SmallActionButtonStyle}">
            <Setter Property="Background" Value="#5C3535"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ErrorBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#CC4444"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ComboBox Style -->
        <Style x:Key="PropertyComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="#252628"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <!-- Color Button Style -->
        <Style x:Key="ColorButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="2"
                                CornerRadius="4">
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Section Card Style -->
        <Style x:Key="SectionCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>

        <!-- Slider Style -->
        <Style x:Key="TrackSliderStyle" TargetType="Slider">
            <Setter Property="Minimum" Value="0"/>
            <Setter Property="Maximum" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Slider">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto" MinHeight="{TemplateBinding MinHeight}"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Border x:Name="TrackBackground"
                                    Grid.Row="1"
                                    Height="4"
                                    Background="{StaticResource BorderBrush}"
                                    CornerRadius="2"
                                    VerticalAlignment="Center"/>
                            <Track x:Name="PART_Track" Grid.Row="1">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Command="Slider.DecreaseLarge">
                                        <RepeatButton.Template>
                                            <ControlTemplate TargetType="RepeatButton">
                                                <Border Background="{StaticResource AccentBrush}" Height="4" CornerRadius="2"/>
                                            </ControlTemplate>
                                        </RepeatButton.Template>
                                    </RepeatButton>
                                </Track.DecreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb>
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Ellipse x:Name="thumbEllipse"
                                                         Width="14" Height="14"
                                                         Fill="{StaticResource AccentBrush}"
                                                         Stroke="#0D0D0D"
                                                         StrokeThickness="2"/>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Command="Slider.IncreaseLarge">
                                        <RepeatButton.Template>
                                            <ControlTemplate TargetType="RepeatButton">
                                                <Border Background="Transparent"/>
                                            </ControlTemplate>
                                        </RepeatButton.Template>
                                    </RepeatButton>
                                </Track.IncreaseRepeatButton>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Boolean to Visibility Converter -->
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Padding="12,10"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#181818" Offset="0"/>
                    <GradientStop Color="#252628" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <DockPanel>
                <TextBlock Text="Track Properties"
                           FontWeight="SemiBold"
                           FontSize="12"
                           Foreground="{StaticResource BrightForegroundBrush}"
                           VerticalAlignment="Center"/>
                <Button x:Name="CloseButton"
                        DockPanel.Dock="Right"
                        Content="X"
                        Width="24" Height="24"
                        Background="Transparent"
                        BorderThickness="0"
                        Foreground="{StaticResource SecondaryForegroundBrush}"
                        FontSize="10"
                        Cursor="Hand"
                        Click="CloseButton_Click"
                        ToolTip="Close Panel">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </DockPanel>
        </Border>

        <!-- Content -->
        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Padding="8">
            <StackPanel>
                <!-- No Track Selected State -->
                <Border x:Name="EmptyState"
                        Visibility="{Binding HasSelectedTrack, Converter={StaticResource BoolToVis}, ConverterParameter=Inverse}"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Center"
                        Margin="20,60">
                    <StackPanel HorizontalAlignment="Center">
                        <Border Width="50" Height="50"
                                CornerRadius="25"
                                Background="#252628"
                                HorizontalAlignment="Center"
                                Margin="0,0,0,16">
                            <TextBlock Text="T"
                                       FontSize="20"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource SecondaryForegroundBrush}"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="No Track Selected"
                                   FontSize="13"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource ForegroundBrush}"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="Select a track in the&#x0a;arrangement to view properties"
                                   FontSize="11"
                                   Foreground="{StaticResource SecondaryForegroundBrush}"
                                   TextAlignment="Center"
                                   HorizontalAlignment="Center"
                                   Margin="0,8,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Properties Panel (visible when track is selected) -->
                <StackPanel x:Name="PropertiesContent"
                            Visibility="{Binding HasSelectedTrack, Converter={StaticResource BoolToVis}}">

                    <!-- Track Identity Section -->
                    <Border Style="{StaticResource SectionCardStyle}">
                        <StackPanel>
                            <TextBlock Text="TRACK" Style="{StaticResource SectionHeaderStyle}"/>

                            <!-- Track Name -->
                            <StackPanel Margin="0,0,0,12">
                                <TextBlock Text="Name" Style="{StaticResource PropertyLabelStyle}" Margin="0,0,0,4"/>
                                <TextBox x:Name="TrackNameTextBox"
                                         Style="{StaticResource PropertyTextBoxStyle}"
                                         Text="{Binding TrackName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         KeyDown="TrackNameTextBox_KeyDown"/>
                            </StackPanel>

                            <!-- Track Type Display -->
                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Type" Style="{StaticResource PropertyLabelStyle}" Width="60"/>
                                <Border Grid.Column="1"
                                        CornerRadius="4" Padding="8,4"
                                        HorizontalAlignment="Left">
                                    <Border.Background>
                                        <SolidColorBrush Color="#3C3F44"/>
                                    </Border.Background>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock x:Name="TrackTypeIcon"
                                                   Text="{Binding SelectedTrack.IconSymbol}"
                                                   FontSize="12"
                                                   Foreground="{StaticResource AccentBrush}"
                                                   Margin="0,0,6,0"/>
                                        <TextBlock Text="{Binding TrackType}"
                                                   Style="{StaticResource PropertyValueStyle}"
                                                   FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <!-- Track Color -->
                            <StackPanel Margin="0,0,0,0">
                                <TextBlock Text="Color" Style="{StaticResource PropertyLabelStyle}" Margin="0,0,0,6"/>
                                <WrapPanel>
                                    <ItemsControl ItemsSource="{Binding ColorOptions}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Button Style="{StaticResource ColorButtonStyle}"
                                                        Background="{Binding Brush}"
                                                        ToolTip="{Binding Name}"
                                                        Click="ColorButton_Click"
                                                        Tag="{Binding Color}"/>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </WrapPanel>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Track Controls Section -->
                    <Border Style="{StaticResource SectionCardStyle}">
                        <StackPanel>
                            <TextBlock Text="CONTROLS" Style="{StaticResource SectionHeaderStyle}"/>

                            <!-- M/S/R/F Buttons -->
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,12">
                                <!-- Mute -->
                                <ToggleButton x:Name="MuteButton"
                                              Style="{StaticResource TrackToggleButtonStyle}"
                                              Content="M"
                                              IsChecked="{Binding IsMuted, Mode=TwoWay}"
                                              ToolTip="Mute"
                                              Margin="0,0,4,0">
                                    <ToggleButton.Triggers>
                                        <EventTrigger RoutedEvent="ToggleButton.Checked">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <ColorAnimation Storyboard.TargetProperty="(ToggleButton.Background).(SolidColorBrush.Color)"
                                                                    To="#FF5555" Duration="0:0:0.1"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                        <EventTrigger RoutedEvent="ToggleButton.Unchecked">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <ColorAnimation Storyboard.TargetProperty="(ToggleButton.Background).(SolidColorBrush.Color)"
                                                                    To="#3C3F44" Duration="0:0:0.1"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </ToggleButton.Triggers>
                                </ToggleButton>

                                <!-- Solo -->
                                <ToggleButton x:Name="SoloButton"
                                              Style="{StaticResource TrackToggleButtonStyle}"
                                              Content="S"
                                              IsChecked="{Binding IsSoloed, Mode=TwoWay}"
                                              ToolTip="Solo"
                                              Margin="0,0,4,0">
                                    <ToggleButton.Triggers>
                                        <EventTrigger RoutedEvent="ToggleButton.Checked">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <ColorAnimation Storyboard.TargetProperty="(ToggleButton.Background).(SolidColorBrush.Color)"
                                                                    To="#FFDD55" Duration="0:0:0.1"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                        <EventTrigger RoutedEvent="ToggleButton.Unchecked">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <ColorAnimation Storyboard.TargetProperty="(ToggleButton.Background).(SolidColorBrush.Color)"
                                                                    To="#3C3F44" Duration="0:0:0.1"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </ToggleButton.Triggers>
                                </ToggleButton>

                                <!-- Record Arm -->
                                <ToggleButton x:Name="ArmButton"
                                              Style="{StaticResource TrackToggleButtonStyle}"
                                              Content="R"
                                              IsChecked="{Binding IsArmed, Mode=TwoWay}"
                                              IsEnabled="{Binding CanArm}"
                                              ToolTip="Record Arm"
                                              Margin="0,0,4,0">
                                    <ToggleButton.Triggers>
                                        <EventTrigger RoutedEvent="ToggleButton.Checked">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <ColorAnimation Storyboard.TargetProperty="(ToggleButton.Background).(SolidColorBrush.Color)"
                                                                    To="#FF3333" Duration="0:0:0.1"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                        <EventTrigger RoutedEvent="ToggleButton.Unchecked">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <ColorAnimation Storyboard.TargetProperty="(ToggleButton.Background).(SolidColorBrush.Color)"
                                                                    To="#3C3F44" Duration="0:0:0.1"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </ToggleButton.Triggers>
                                </ToggleButton>

                                <!-- Monitor -->
                                <ToggleButton x:Name="MonitorButton"
                                              Style="{StaticResource TrackToggleButtonStyle}"
                                              Content="I"
                                              IsChecked="{Binding IsMonitoring, Mode=TwoWay}"
                                              ToolTip="Input Monitor"
                                              Margin="0,0,4,0">
                                    <ToggleButton.Triggers>
                                        <EventTrigger RoutedEvent="ToggleButton.Checked">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <ColorAnimation Storyboard.TargetProperty="(ToggleButton.Background).(SolidColorBrush.Color)"
                                                                    To="#00FF88" Duration="0:0:0.1"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                        <EventTrigger RoutedEvent="ToggleButton.Unchecked">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <ColorAnimation Storyboard.TargetProperty="(ToggleButton.Background).(SolidColorBrush.Color)"
                                                                    To="#3C3F44" Duration="0:0:0.1"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </ToggleButton.Triggers>
                                </ToggleButton>

                                <!-- Freeze -->
                                <ToggleButton x:Name="FreezeButton"
                                              Style="{StaticResource TrackToggleButtonStyle}"
                                              Content="F"
                                              IsChecked="{Binding IsFrozen, Mode=TwoWay}"
                                              IsEnabled="{Binding CanFreeze}"
                                              ToolTip="Freeze Track">
                                    <ToggleButton.Triggers>
                                        <EventTrigger RoutedEvent="ToggleButton.Checked">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <ColorAnimation Storyboard.TargetProperty="(ToggleButton.Background).(SolidColorBrush.Color)"
                                                                    To="#55DDFF" Duration="0:0:0.1"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                        <EventTrigger RoutedEvent="ToggleButton.Unchecked">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <ColorAnimation Storyboard.TargetProperty="(ToggleButton.Background).(SolidColorBrush.Color)"
                                                                    To="#3C3F44" Duration="0:0:0.1"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </ToggleButton.Triggers>
                                </ToggleButton>
                            </StackPanel>

                            <!-- Volume -->
                            <Grid Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="50"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="50"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Volume" Style="{StaticResource PropertyLabelStyle}"/>
                                <Slider Grid.Column="1"
                                        Style="{StaticResource TrackSliderStyle}"
                                        Value="{Binding Volume, Mode=TwoWay}"
                                        Minimum="0" Maximum="1.25"
                                        VerticalAlignment="Center"
                                        Margin="8,0"
                                        MouseDoubleClick="VolumeSlider_MouseDoubleClick"/>
                                <TextBlock Grid.Column="2"
                                           Text="{Binding VolumeDb}"
                                           Style="{StaticResource PropertyValueStyle}"
                                           HorizontalAlignment="Right"
                                           FontSize="10"
                                           FontFamily="Consolas"/>
                            </Grid>

                            <!-- Pan -->
                            <Grid Margin="0,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="50"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="50"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Pan" Style="{StaticResource PropertyLabelStyle}"/>
                                <Slider Grid.Column="1"
                                        Style="{StaticResource TrackSliderStyle}"
                                        Value="{Binding Pan, Mode=TwoWay}"
                                        Minimum="-1" Maximum="1"
                                        VerticalAlignment="Center"
                                        Margin="8,0"
                                        MouseDoubleClick="PanSlider_MouseDoubleClick"/>
                                <TextBlock Grid.Column="2"
                                           Text="{Binding PanDisplay}"
                                           Style="{StaticResource PropertyValueStyle}"
                                           HorizontalAlignment="Right"
                                           FontSize="10"
                                           FontFamily="Consolas"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Routing Section -->
                    <Border Style="{StaticResource SectionCardStyle}">
                        <StackPanel>
                            <TextBlock Text="ROUTING" Style="{StaticResource SectionHeaderStyle}"/>

                            <!-- Input Source -->
                            <Grid Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Input" Style="{StaticResource PropertyLabelStyle}"/>
                                <ComboBox Grid.Column="1"
                                          Style="{StaticResource PropertyComboBoxStyle}"
                                          ItemsSource="{Binding InputSources}"
                                          SelectedItem="{Binding SelectedInputSource}"
                                          DisplayMemberPath="Name"/>
                            </Grid>

                            <!-- Output Bus -->
                            <Grid Margin="0,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Output" Style="{StaticResource PropertyLabelStyle}"/>
                                <ComboBox Grid.Column="1"
                                          Style="{StaticResource PropertyComboBoxStyle}"
                                          ItemsSource="{Binding OutputBuses}"
                                          SelectedItem="{Binding SelectedOutputBus}"
                                          DisplayMemberPath="Name"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- MIDI Options (visible for Instrument tracks) -->
                    <Border Style="{StaticResource SectionCardStyle}"
                            Visibility="{Binding ShowMidiOptions, Converter={StaticResource BoolToVis}}">
                        <StackPanel>
                            <TextBlock Text="MIDI" Style="{StaticResource SectionHeaderStyle}"/>

                            <!-- MIDI Channel -->
                            <Grid Margin="0,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Channel" Style="{StaticResource PropertyLabelStyle}"/>
                                <ComboBox Grid.Column="1"
                                          Style="{StaticResource PropertyComboBoxStyle}"
                                          ItemsSource="{Binding MidiChannelOptions}"
                                          SelectedIndex="{Binding MidiChannel}"
                                          DisplayMemberPath="Name"/>
                            </Grid>

                            <!-- Instrument Name -->
                            <Grid Margin="0,10,0,0" Visibility="{Binding InstrumentName, Converter={StaticResource BoolToVis}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Inst." Style="{StaticResource PropertyLabelStyle}"/>
                                <TextBlock Grid.Column="1"
                                           Text="{Binding InstrumentName}"
                                           Style="{StaticResource PropertyValueStyle}"
                                           TextTrimming="CharacterEllipsis"
                                           ToolTip="{Binding InstrumentName}"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Audio Options (visible for Audio tracks) -->
                    <Border Style="{StaticResource SectionCardStyle}"
                            Visibility="{Binding ShowAudioOptions, Converter={StaticResource BoolToVis}}">
                        <StackPanel>
                            <TextBlock Text="AUDIO INPUT" Style="{StaticResource SectionHeaderStyle}"/>

                            <!-- Audio Input -->
                            <Grid Margin="0,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Input" Style="{StaticResource PropertyLabelStyle}"/>
                                <ComboBox Grid.Column="1"
                                          Style="{StaticResource PropertyComboBoxStyle}"
                                          ItemsSource="{Binding AudioInputs}"
                                          SelectedItem="{Binding SelectedAudioInput}"
                                          DisplayMemberPath="Name"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Display Section -->
                    <Border Style="{StaticResource SectionCardStyle}">
                        <StackPanel>
                            <TextBlock Text="DISPLAY" Style="{StaticResource SectionHeaderStyle}"/>

                            <!-- Track Height -->
                            <Grid Margin="0,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="40"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Height" Style="{StaticResource PropertyLabelStyle}"/>
                                <Slider Grid.Column="1"
                                        Style="{StaticResource TrackSliderStyle}"
                                        Value="{Binding TrackHeight, Mode=TwoWay}"
                                        Minimum="24" Maximum="200"
                                        VerticalAlignment="Center"
                                        Margin="8,0"/>
                                <TextBlock Grid.Column="2"
                                           Text="{Binding TrackHeight, StringFormat={}{0:F0}}"
                                           Style="{StaticResource PropertyValueStyle}"
                                           HorizontalAlignment="Right"
                                           FontSize="10"
                                           FontFamily="Consolas"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Actions Section -->
                    <Border Style="{StaticResource SectionCardStyle}">
                        <StackPanel>
                            <TextBlock Text="ACTIONS" Style="{StaticResource SectionHeaderStyle}"/>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="8"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Button Grid.Column="0"
                                        Style="{StaticResource SmallActionButtonStyle}"
                                        Content="Duplicate"
                                        Command="{Binding DuplicateCommand}"
                                        ToolTip="Create a copy of this track"/>

                                <Button Grid.Column="2"
                                        Style="{StaticResource DangerButtonStyle}"
                                        Content="Delete"
                                        Command="{Binding DeleteCommand}"
                                        ToolTip="Delete this track"/>
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
